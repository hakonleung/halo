# ARC 重构工作流

纯技术重构，不改变功能行为，跳过产品设计阶段。

## 参数

$ARGUMENTS

格式: `[范围] [目标]`

示例:
- `src/lib/auth-service.ts 拆分为多个小文件`
- `全局 将所有 any 类型替换为具体类型`

## 执行流程

请严格按照 `ai-coding/action-refactor.md` 定义的流程执行：

### 1. 初始化

1. 解析参数，获取重构范围和目标
2. 生成重构单号 `REF_XXX`
3. 创建 Git 分支 `refactor/REF_XXX`
4. 创建工作目录 `ai-coding/works/REF_XXX/`

### 2. 执行 4 阶段

| 阶段 | 目标 | 产出 |
|------|------|------|
| R1 分析评估 | 扫描代码、识别问题、制定计划 | `plan.md` |
| R2 安全网建立 | 检查测试覆盖、补充测试 | `baseline.md` |
| R3 逐步重构 | 小步快跑、每步验证提交 | 多个 commits |
| R4 验证确认 | 全量测试、对比基准 | `report.md` |

### 3. 重构原则

1. **行为不变**: 重构前后功能完全一致
2. **小步快跑**: 每次只做一小步，频繁提交
3. **测试保障**: 有测试覆盖才能放心重构
4. **可回滚**: 每个提交都是可回滚的状态

### 4. R3 每步规则

- 每次只做一件事
- 每步都验证：`pnpm tsc --noEmit && pnpm lint && pnpm test`
- 每步都提交：`refactor: [REF_XXX] step N - 具体操作`
- 失败就回滚

### 5. 常用重构模式

| 模式 | 适用场景 |
|------|---------|
| 提取函数 | 函数过长 |
| 提取文件 | 文件过大 |
| 内联变量 | 变量只用一次 |
| 重命名 | 命名不清晰 |
| 合并重复 | 重复代码 |
| 简化条件 | 条件过复杂 |

## 用户响应格式

- `确认` / `通过` - 进入下一步
- `修改 [内容]` - 修改指定内容
- `跳过测试补充` - 接受当前覆盖率，继续重构

请开始执行工作流。
