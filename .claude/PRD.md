# 用户故事

我想要一个 web 应用来记录和追踪我的生活，并展示习惯或目标的可视化趋势，且能给我生成一些建议。

# 痛点

1. 对习惯或目标的定义不够个性化，用户想要写日志/记账/设计目标，就需要使用多个 app
2. 可视化对用户帮助不大，依赖用户自身的分析和总结能力
3. 没有利用 ai 的能力

# 品牌和设计语言

## 1. 品牌定位

- **品牌名**：NEO-LOG
- **品牌理念**：AI 原生的个人生活追踪系统，赛博朋克美学与实用主义的结合
- **核心价值**：个性化、智能化、可视化
- **Slogan 参考**：「Log your life. Hack your future.」/「数据觉醒，生活进化」

## 2. 视觉风格

### 2.1 整体调性

- 赛博朋克 + 复古未来主义（Retro-Futurism）
- Matrix 风格的数据流美学
- 科幻 HUD（Heads-Up Display）界面感
- 紧凑信息密度，高效利用空间

### 2.2 配色方案

#### 主色

| 名称                  | 色值      | 用途                        |
| --------------------- | --------- | --------------------------- |
| 矩阵绿 (Matrix Green) | `#00FF41` | 主强调色、成功状态、AI 响应 |
| 警报橙 (Alert Orange) | `#FF6B35` | 次强调色、警告、重要操作    |
| 电光蓝 (Cyber Blue)   | `#00D4FF` | 链接、可交互元素、信息提示  |

#### 背景色

| 名称                | 色值      | 用途               |
| ------------------- | --------- | ------------------ |
| 深空黑 (Deep Black) | `#0A0A0A` | 主背景             |
| 碳灰 (Carbon Gray)  | `#1A1A1A` | 卡片/容器背景      |
| 暗灰 (Dark Gray)    | `#2A2A2A` | 悬停状态、次级容器 |

#### 文字色

| 名称                | 色值      | 用途             |
| ------------------- | --------- | ---------------- |
| 荧光白 (Neon White) | `#E0E0E0` | 主文字           |
| 灰雾 (Mist Gray)    | `#888888` | 次要文字、占位符 |
| 暗淡灰 (Dim Gray)   | `#555555` | 禁用状态         |

#### 语义色

| 状态 | 色值               |
| ---- | ------------------ |
| 成功 | `#00FF41` (矩阵绿) |
| 警告 | `#FFD700` (金黄)   |
| 错误 | `#FF3366` (霓虹红) |
| 信息 | `#00D4FF` (电光蓝) |

### 2.3 背景处理

- **主背景**：深空黑 + 半透明网格纹理叠加（电路板/网格线）
- **网格规格**：`40px × 40px`，线条颜色 `rgba(0, 255, 65, 0.05)`
- **可选增强**：局部扫描线效果、CRT 显示器微弱曲面失真

## 3. 字体系统

### 3.1 字体选择

| 用途      | 英文字体                      | 中文字体            | 备选       |
| --------- | ----------------------------- | ------------------- | ---------- |
| 品牌/标题 | **Press Start 2P**            | 像素字体（如 Zpix） | Silkscreen |
| 正文      | **VT323** / **IBM Plex Mono** | 思源黑体            | Fira Code  |
| 数据/代码 | **JetBrains Mono**            | -                   | Fira Code  |

### 3.2 字体层级

| 层级    | 大小 | 字重     | 用途             |
| ------- | ---- | -------- | ---------------- |
| H1      | 32px | Bold     | 页面标题         |
| H2      | 24px | Bold     | 区块标题         |
| H3      | 18px | SemiBold | 卡片标题         |
| Body    | 14px | Regular  | 正文内容         |
| Caption | 12px | Regular  | 辅助说明、时间戳 |
| Micro   | 10px | Regular  | 标签、徽章       |

### 3.3 字体特效

- 标题文字可带微弱发光（`text-shadow: 0 0 10px currentColor`）
- 重要数据可使用像素字体突出

## 4. 图标系统

### 4.1 风格

- **类型**：填充式图标 + 外发光效果
- **线条粗细**：2px
- **圆角**：2px（保持像素感）
- **发光效果**：`filter: drop-shadow(0 0 4px currentColor)`

### 4.2 图标库建议

- 优先使用：Phosphor Icons（支持 Fill 风格）
- 备选：Lucide Icons + 自定义发光效果
- 特殊场景：自制像素图标

### 4.3 图标尺寸

| 场景       | 尺寸 |
| ---------- | ---- |
| 导航图标   | 24px |
| 按钮内图标 | 18px |
| 卡片图标   | 20px |
| 徽章/标签  | 14px |

## 5. 组件设计规范

### 5.1 边框与圆角

- **默认圆角**：4px（保持硬朗感）
- **边框样式**：1px solid，带故障动画
- **故障边框动画**：
  - 随机 2-5 秒触发一次
  - 边框颜色短暂闪烁/位移 50-100ms
  - 实现参考：`@keyframes glitch-border`

### 5.2 卡片组件

```
背景：#1A1A1A
边框：1px solid rgba(0, 255, 65, 0.3)
发光：box-shadow: 0 0 15px rgba(0, 255, 65, 0.1)
悬停：边框亮度增加，发光半径扩大
故障：随机触发边框抖动效果
```

### 5.3 按钮组件

#### 主按钮 (Primary)

```
背景：渐变 (#00FF41 → #00CC33)
文字：#0A0A0A
边框：无
悬停：亮度增加 10%，发光增强
按下：触发 100ms 故障效果（色相偏移 + 轻微位移）
```

#### 次按钮 (Secondary)

```
背景：透明
文字：#00FF41
边框：1px solid #00FF41
悬停：背景填充 rgba(0, 255, 65, 0.1)
按下：故障效果
```

#### 危险按钮 (Danger)

```
背景：透明
文字：#FF3366
边框：1px solid #FF3366
悬停：背景填充 rgba(255, 51, 102, 0.1)
```

### 5.4 输入框组件

```
背景：#0A0A0A
边框：1px solid #2A2A2A
聚焦：边框变为 #00FF41，外发光
光标：闪烁的块状光标（可选）
占位符：#555555，可带打字机动画
```

### 5.5 标签/徽章

```
背景：半透明主色（如 rgba(0, 255, 65, 0.2)）
文字：对应主色
边框：1px solid 对应主色
字体：Micro 尺寸，全大写
```

## 6. 动画系统

### 6.1 动画原则

- **大量但不干扰**：动画增强氛围，但不阻塞操作
- **性能优先**：使用 CSS 动画和 `transform`，避免重排
- **可关闭**：提供减少动画的无障碍选项

### 6.2 过渡动画

| 场景     | 时长  | 缓动        |
| -------- | ----- | ----------- |
| 悬停状态 | 150ms | ease-out    |
| 页面切换 | 300ms | ease-in-out |
| 弹窗出现 | 200ms | ease-out    |
| 弹窗消失 | 150ms | ease-in     |

### 6.3 特色动画

#### 故障效果 (Glitch)

- **触发场景**：按钮点击、错误提示、页面加载完成
- **表现**：RGB 分离 + 水平位移 + 噪点叠加
- **时长**：100-200ms

#### 打字机效果 (Typewriter)

- **触发场景**：AI 回复输出、重要文字展示
- **表现**：文字逐字符出现，带闪烁光标
- **速度**：30-50ms/字符

#### 矩阵数据流 (Matrix Rain)

- **触发场景**：加载状态、AI 思考中、背景装饰
- **表现**：绿色字符从上向下流动
- **密度**：可配置，默认中等密度

#### 扫描线 (Scan Line)

- **触发场景**：页面背景、卡片装饰
- **表现**：水平线条从上到下缓慢移动
- **周期**：3-5 秒一次

#### 脉冲发光 (Pulse Glow)

- **触发场景**：重要数据更新、新消息提示
- **表现**：发光强度周期性变化
- **周期**：1-2 秒

### 6.4 加载动画

- **主加载**：矩阵数据流效果 + 进度百分比
- **局部加载**：闪烁光标 `▌` 或跳动的像素点
- **骨架屏**：深灰色块 + 扫描线动画

## 7. AI 视觉身份

### 7.1 AI 标识

- **形象**：闪烁的终端光标 `▌` 或 `>`
- **颜色**：矩阵绿 #00FF41
- **动画**：持续闪烁（500ms 周期）

### 7.2 AI 对话气泡

```
背景：rgba(0, 255, 65, 0.05)
左边框：3px solid #00FF41
无圆角或 2px 圆角
```

### 7.3 AI 思考状态

- **表现**：打字机效果输出「分析中...」「生成建议...」等状态文字
- **增强**：文字旁显示小型脑电波/数据流动画
- **时机**：API 请求期间持续显示

### 7.4 用户消息气泡

```
背景：#2A2A2A
右对齐
圆角：4px
```

## 8. Logo 设计规范

### 8.1 Logo 构成

- **类型**：几何文字标 + 发光效果
- **字体**：定制几何无衬线或 Press Start 2P
- **结构**：「NEO」与「LOG」可用不同颜色或分隔符区分
- **分隔符**：可用 `-`、`_`、`/` 或竖线

### 8.2 Logo 变体

| 变体       | 用途                    |
| ---------- | ----------------------- |
| 全彩发光版 | 深色背景、官网首页      |
| 单色版     | 图标、favicon、受限场景 |
| 动画版     | 启动画面、加载页        |

### 8.3 Logo 发光效果

```css
text-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41, 0 0 20px #00ff41, 0 0 40px
    #00ff41;
```

### 8.4 安全空间

- Logo 四周保留至少 1 个「N」字母宽度的空白

## 9. 响应式与布局

### 9.1 断点

| 名称    | 宽度       | 说明         |
| ------- | ---------- | ------------ |
| Mobile  | < 640px    | 单列布局     |
| Tablet  | 640-1024px | 双列布局     |
| Desktop | > 1024px   | 多列网格布局 |

### 9.2 布局原则

- **移动端优先**：先设计移动端，再扩展桌面端
- **紧凑布局**：信息密度高，减少无效空白
- **固定导航**：底部 Tab 栏（移动端）/ 侧边栏（桌面端）

### 9.3 间距系统

- 基础单位：4px
- 常用间距：4px / 8px / 12px / 16px / 24px / 32px

## 10. 易用性原则

### 10.1 交互优化

- 高频操作入口明显（如记录按钮常驻可见）
- 最大程度减少交互步数（如快捷指令、手势操作）
- 支持键盘快捷键（桌面端）

### 10.2 无障碍

- 提供「减少动画」模式
- 确保颜色对比度符合 WCAG AA 标准（4.5:1）
- 支持屏幕阅读器

### 10.3 反馈机制

- 所有操作都有即时视觉反馈
- 错误信息清晰、带解决建议
- 成功操作有简短确认动画

# 模块

1.  登录模块
    1.0 技术基础 - 后端服务：Supabase Auth - 会话管理：JWT Token + Refresh Token - 前端状态：React Context / Zustand 封装认证状态

    1.1 登录方式
    1.1.1 邮箱 + 密码登录 - 输入字段：邮箱、密码 - 密码强度要求：至少 8 位，必须包含字母和数字 - 「记住我」选项：勾选后会话有效期延长至 30 天，否则为 7 天 - 登录失败处理： - 密码错误：显示「邮箱或密码错误」（不区分具体原因） - 账户未验证：提示「请先验证邮箱」并提供重发验证邮件入口 - 频率限制：5 次失败后锁定 15 分钟
    1.1.2 GitHub OAuth 登录 - 一键跳转 GitHub 授权 - 首次登录自动创建账户 - 获取 GitHub 头像和用户名作为默认信息 - 可后续绑定邮箱密码作为备用登录方式

    1.2 注册流程
    1.2.1 注册表单 - 输入字段：邮箱、密码、确认密码 - 密码强度实时检测： - 弱（红色）：少于 8 位或纯字母/数字 - 中（黄色）：8 位以上，包含字母和数字 - 强（绿色）：12 位以上，包含大小写、数字、特殊字符 - 密码可见性切换按钮
    1.2.2 邮箱验证 - 注册成功后发送验证邮件 - 验证邮件有效期：24 小时 - 未验证状态：可登录但进入「受限体验模式」，提示验证 - 重发验证邮件：60 秒冷却时间
    1.2.3 验证成功 - 点击邮件链接后跳转回应用 - 显示「验证成功」动画（故障效果 + 矩阵绿闪烁） - 自动登录并进入主界面

    1.3 密码找回
    1.3.1 发起重置 - 输入注册邮箱 - 发送 6 位数字验证码到邮箱 - 验证码有效期：10 分钟 - 重发冷却：60 秒
    1.3.2 验证与重置 - 输入验证码（6 位数字输入框，自动跳转下一位） - 验证通过后设置新密码 - 新密码不能与最近 3 次密码相同 - 重置成功后所有设备登出，需重新登录

    1.4 访客体验模式
    1.4.1 允许体验的功能 - 查看应用介绍和功能演示 - 体验 AI 对话（使用演示数据，限制 5 轮对话） - 查看示例可视化图表
    1.4.2 受限功能 - 无法保存任何数据 - 无法配置个人 API Key - 对话历史不保存
    1.4.3 引导注册 - 在体验过程中适时提示注册 - 提供「保存此对话」作为注册激励

    1.5 会话管理
    1.5.1 Token 机制 - Access Token：短期有效（15 分钟） - Refresh Token：长期有效（7/30 天，根据「记住我」） - 自动刷新：Access Token 过期前 5 分钟自动刷新
    1.5.2 多设备管理 - 用户可查看当前登录的设备列表 - 支持远程登出指定设备 - 支持「登出所有设备」
    1.5.3 登出 - 清除本地 Token - 可选：仅登出当前设备 / 登出所有设备

    1.6 安全措施
    1.6.1 登录保护 - 登录失败次数限制（5 次/15 分钟） - 异地登录提醒（可选邮件通知） - HTTPS 强制
    1.6.2 密码安全 - 密码哈希存储（Supabase 默认 bcrypt） - 传输过程加密 - 禁止常见弱密码（可选）
    1.6.3 CSRF 防护 - State 参数验证（OAuth 流程） - SameSite Cookie 策略

    1.7 登录页面设计
    1.7.1 视觉效果 - 背景：全屏矩阵雨动画（绿色字符下落） - 登录卡片：半透明深色背景，故障效果边框 - Logo：NEO-LOG 发光动画，顶部居中 - 表单元素：输入框聚焦时边框发光 + 光标闪烁
    1.7.2 动画效果 - 页面加载：矩阵雨逐渐出现，卡片从中心展开 - 登录按钮：点击时触发故障效果 - 登录成功：数据流汇聚动画 → 跳转主界面 - 登录失败：卡片短暂震动 + 红色边框闪烁
    1.7.3 布局 - 移动端：卡片占满宽度，垂直居中 - 桌面端：卡片居中，最大宽度 400px - 登录/注册切换：Tab 或链接切换，带滑动动画
    1.7.4 表单交互 - 输入框占位符：打字机效果显示提示文字 - 密码强度条：实时更新，带颜色渐变 - 验证错误：输入框下方红色提示，带轻微抖动 - GitHub 登录按钮：独立样式，带 GitHub 图标

    1.8 API 封装
    1.8.1 认证服务接口
    `typescript
interface AuthService {
  // 邮箱密码登录
  signInWithEmail(email: string, password: string, rememberMe?: boolean): Promise<AuthResponse>
  // GitHub OAuth 登录
  signInWithGitHub(): Promise<void>
  // 注册
  signUp(email: string, password: string): Promise<AuthResponse>
  // 登出
  signOut(allDevices?: boolean): Promise<void>
  // 发送验证邮件
  sendVerificationEmail(email: string): Promise<void>
  // 发送密码重置验证码
  sendPasswordResetCode(email: string): Promise<void>
  // 验证重置码并设置新密码
  resetPassword(email: string, code: string, newPassword: string): Promise<void>
  // 获取当前用户
  getCurrentUser(): Promise<User | null>
  // 刷新会话
  refreshSession(): Promise<AuthResponse>
  // 获取登录设备列表
  getActiveSessions(): Promise<Session[]>
  // 撤销指定会话
  revokeSession(sessionId: string): Promise<void>
}
`
    1.8.2 认证状态 Hook
    `typescript
interface UseAuth {
  user: User | null
  isLoading: boolean
  isAuthenticated: boolean
  isEmailVerified: boolean
  signIn: (email: string, password: string, rememberMe?: boolean) => Promise<void>
  signInWithGitHub: () => Promise<void>
  signUp: (email: string, password: string) => Promise<void>
  signOut: (allDevices?: boolean) => Promise<void>
  error: AuthError | null
}
`

    1.9 路由保护
    1.9.1 公开路由 - `/` - 落地页/介绍页 - `/login` - 登录页 - `/register` - 注册页 - `/reset-password` - 密码重置 - `/demo` - 访客体验
    1.9.2 受保护路由 - `/dashboard` - 仪表盘 - `/chat` - AI 对话 - `/history/*` - 历史记录 - `/settings` - 用户设置
    1.9.3 路由守卫行为 - 未登录访问受保护路由：重定向到 `/login?redirect=原路径` - 已登录访问登录页：重定向到 `/dashboard` - 登录成功后：跳转到 `redirect` 参数指定的路径或默认 `/dashboard`

2.  chatbot 模块
    2.0 技术架构
    2.0.1 核心技术栈 - LLM 编排：LangChain + LangGraph - 流式输出：Server-Sent Events (SSE) - 语音识别：Web Speech API / Whisper API - 图片处理：多模态 LLM（如 GPT-4V / Claude 3）
    2.0.2 Agent 架构
    `        用户输入 → 路由 Agent → 具体 Agent → 工具调用 → 响应生成
                  ↓
             LangGraph 状态机`
    2.0.3 数据流
    `        前端 → API Gateway → LangGraph → Supabase
                         ↓
                   LLM Provider`

    2.1 路由机制
    2.1.1 快捷指令（优先匹配）
    | 指令 | 触发 Agent | 示例 |
    |------|-----------|------|
    | `/记录` `/r` | 行为记录 | /记录 今天跑步 30 分钟 |
    | `/查询` `/q` | 行为查询 | /查询 本周运动情况 |
    | `/目标` `/g` | 目标记录 | /目标 今年减重 10 斤 |
    | `/查目标` `/qg` | 目标查询 | /查目标 |
    | `/笔记` `/n` | 随手记 | /笔记 突然想到一个点子 |
    | `/查笔记` `/qn` | 随手记查询 | /查笔记 上周 |
    | `/分析` `/a` | 分析 | /分析 本月消费习惯 |
    | `/图表` `/v` | 前端工具 | /图表 本月支出趋势 |
    | `/帮助` `/h` | 显示帮助 | /帮助 |
    2.1.2 LLM 意图识别（无快捷指令时） - 路由 Agent 分析用户输入 - 判断意图类型：记录 / 查询 / 目标 / 随手记 / 分析 / 工具 / 闲聊 - 置信度 < 0.7 时主动追问确认 - 完全无法识别时询问用户意图
    2.1.3 多轮对话支持 - Agent 可追问补充信息 - 支持上下文引用（如「把刚才的金额改成 50」） - 确认敏感操作（如删除、批量修改）

    2.2 行为记录 Agent
    2.2.1 核心流程
    `        用户输入 → 解析行为信息 → 匹配/创建行为定义 → 提取 metadata → 确认 → 保存`
    2.2.2 行为定义匹配 - 拉取用户已有行为定义 + 公共行为定义库 - 使用语义相似度匹配（Embedding 向量比对） - 匹配到：使用已有定义 ID - 未匹配：引导用户创建新定义 - 确定一级类型（健康/支出/收入/习惯/其他） - 确定二级类型（具体行为名称） - 定义 metadata 结构
    2.2.3 Metadata 提取 - 根据行为定义的 metadata schema 提取信息 - 缺失必填字段时追问 - 自动推断时间（默认当前时间，支持「昨天」「上午」等自然语言） - 示例：
    `         用户：跑步30分钟
   提取：{ duration: 30, unit: "分钟", time: "2024-01-15T10:30:00Z" }`
    2.2.4 Metadata Schema 定义（Zod）

    ````typescript
    // 示例：运动行为
    const exerciseSchema = z.object({
    duration: z.number().describe("运动时长"),
    unit: z.enum(["分钟", "小时"]).describe("时长单位"),
    intensity: z.enum(["低", "中", "高"]).optional().describe("运动强度"),
    calories: z.number().optional().describe("消耗卡路里"),
    notes: z.string().optional().describe("备注")
    })

              // 示例：支出行为
              const expenseSchema = z.object({
                amount: z.number().describe("金额"),
                currency: z.string().default("CNY").describe("货币"),
                category: z.string().optional().describe("分类"),
                merchant: z.string().optional().describe("商家"),
                notes: z.string().optional().describe("备注")
              })
              ```
        2.2.5 确认卡片
              - 记录成功后显示结构化确认卡片
              - 卡片内容：
                - 行为类型标签（带颜色）
                - 行为名称
                - 提取的 metadata 字段列表
                - 记录时间
              - 卡片操作：
                - 「编辑」：展开编辑表单，可修改各字段
                - 「删除」：删除此条记录
                - 「再记一条」：快速记录同类型行为
        2.2.6 连续记录模式
              - 触发：用户连续快速输入多条记录
              - 行为：Agent 简化响应，仅返回简短确认 + 卡片
              - 退出：5 秒无输入后恢复正常模式

    2.3 行为查询 Agent
    2.3.1 查询能力 - 时间范围查询：今天/本周/本月/自定义 - 行为类型筛选：按一级/二级类型 - 聚合统计：次数、总量、平均值 - 趋势分析：同比、环比
    2.3.2 自然语言查询示例
    | 用户输入 | 查询解析 |
    |---------|---------|
    | 本周跑了几次步 | 行为=跑步, 时间=本周, 聚合=count |
    | 这个月花了多少钱 | 类型=支出, 时间=本月, 聚合=sum(amount) |
    | 最近排便情况怎么样 | 行为=排便, 时间=近 7 天, 展示=列表+总结 |
    2.3.3 响应格式 - 文字总结：自然语言概括查询结果 - 数据列表：表格形式展示详细记录 - 可折叠/展开 - 支持点击跳转到编辑 - 相关建议：基于数据给出简短建议（可选）

    2.4 目标记录 Agent
    2.4.1 目标创建流程
    `          用户描述目标 → 提取目标信息 → 关联行为 → 定义达成基准 → 确认 → 保存
         `
    2.4.2 目标结构
    ```typescript
    interface Goal {
    id: string
    name: string // 目标名称
    description: string // 目标描述
    category: string // 分类（健康/财务/习惯/学习/其他）
    linkedBehaviors: string[] // 关联的行为定义 ID
    criteria: GoalCriteria[] // 达成基准
    startDate: Date // 开始日期
    endDate?: Date // 结束日期（可选，无则为长期目标）
    status: "active" | "completed" | "abandoned"
    }

              interface GoalCriteria {
                behaviorId: string              // 关联行为
                metric: string                  // 指标（如 count, sum, avg）
                operator: ">" | ">=" | "<" | "<=" | "=="
                value: number                   // 目标值
                period: "daily" | "weekly" | "monthly"  // 周期
                description: string             // 人类可读描述
              }
              ```
        2.4.3 多轮对话引导
              - 第一轮：获取目标描述
              - 第二轮：确认/选择关联行为
              - 第三轮：定义达成基准
              - 第四轮：确认并保存
        2.4.4 示例对话
              ```
              用户：我想今年更健康
              AI：好的目标！为了追踪「今年更健康」，你想关注哪些行为？
                  建议关联：运动、睡眠、排便、饮食
                  [运动] [睡眠] [排便] [饮食] [其他...]
              用户：运动和排便
              AI：明白。请帮我定义达成基准：
                  - 运动方面，你希望达到什么标准？（如：每周运动3次，每次30分钟以上）
                  - 排便方面呢？（如：每日1-2次，颜色正常）
              用户：每周运动4次，每日排便1次就行
              AI：收到！已创建目标：
                  [目标卡片：今年更健康]
                  ├ 运动：每周 ≥ 4 次
                  └ 排便：每日 ≥ 1 次
                  [确认] [修改]
              ```

    2.5 目标查询 Agent
    2.5.1 查询内容 - 目标列表及状态 - 各目标当前进度 - 达成/未达成天数统计 - 趋势预测
    2.5.2 响应格式 - 目标进度卡片（环形进度条） - 文字总结 - 改进建议

    2.6 随手记 Agent
    2.6.1 处理流程
    `          用户输入 → 生成标题 → 提取标签 → 保存
         `
    2.6.2 自动处理 - 标题生成：LLM 总结为 10 字以内标题 - 标签提取：识别关键词作为标签 - 时间戳：记录创建时间
    2.6.3 响应 - 简短确认 + 随手记卡片 - 卡片显示：标题、内容预览、标签、时间

    2.7 随手记查询 Agent
    2.7.1 查询方式 - 按时间范围 - 按标签筛选 - 关键词搜索
    2.7.2 响应格式 - 随手记列表（标题 + 时间） - 可展开查看完整内容

    2.8 分析 Agent
    2.8.1 核心能力
          - 趋势分析：识别行为模式、变化趋势、周期性规律
          - 异常检测：发现异常数据、突变、偏离正常范围的情况
          - 相关性分析：发现不同行为之间的关联关系
          - 智能建议：基于分析结果给出可操作的改进建议
    2.8.2 触发方式
          - 快捷指令：`/分析` `/a`
          - 自然语言示例：
            - 「分析一下我最近的消费习惯」
            - 「我的运动数据有什么规律吗」
            - 「帮我看看哪些行为相互关联」
            - 「最近有什么异常吗」
    2.8.3 趋势分析
          2.8.3.1 分析内容
                  - 时间趋势：日/周/月维度的变化趋势（上升/下降/平稳）
                  - 周期规律：识别周期性模式（如每周一支出较高）
                  - 同比/环比：与历史同期对比
                  - 预测趋势：基于历史数据预测未来走向
          2.8.3.2 示例输出
                  ```
                  📊 运动趋势分析（最近30天）

                  【总体趋势】
                  - 运动频率：平均每周 3.2 次，较上月 ↑15%
                  - 运动时长：平均每次 28 分钟，保持稳定
                  - 总运动时长：本月 6.5 小时，较上月 ↑20%

                  【周期规律】
                  - 周末运动频率明显高于工作日（周末 2.1 次/周 vs 工作日 1.1 次/周）
                  - 周三是运动低谷日，建议调整

                  【趋势预测】
                  - 按当前趋势，下月预计运动 7.8 小时

                  [查看详细图表]
                  ```
    2.8.4 异常检测
          2.8.4.1 检测类型
                  - 数值异常：超出正常范围的数据（如单日支出异常高）
                  - 频率异常：行为频率突然变化（如连续多天未记录）
                  - 模式异常：偏离日常模式（如睡眠时间大幅改变）
                  - 目标预警：目标进度严重滞后
          2.8.4.2 异常等级
                  | 等级 | 颜色 | 说明 |
                  |-----|------|------|
                  | 提示 | 电光蓝 | 轻微偏离，仅供参考 |
                  | 注意 | 警报橙 | 明显异常，建议关注 |
                  | 警告 | 霓虹红 | 严重异常，需要重视 |
          2.8.4.3 示例输出
                  ```
                  ⚠️ 异常检测报告（最近7天）

                  【发现 2 个异常】

                  🔴 警告：支出异常
                  - 1月15日支出 ¥2,580，是日均支出的 8.6 倍
                  - 原因分析：当日有「数码产品」类别的大额支出
                  - 建议：确认是否为计划内消费

                  🟠 注意：运动中断
                  - 已连续 5 天未记录运动
                  - 上次运动：1月12日 跑步30分钟
                  - 建议：如身体状况允许，建议恢复运动习惯

                  [查看历史异常]
                  ```
    2.8.5 相关性分析
          2.8.5.1 分析类型
                  - 行为相关：不同行为之间的关联（如运动与睡眠质量）
                  - 时间相关：时间因素对行为的影响（如周末vs工作日）
                  - 因果推断：尝试识别可能的因果关系（仅供参考）
          2.8.5.2 相关性展示
                  - 相关系数：-1 到 1 的数值，绝对值越大相关性越强
                  - 相关方向：正相关（同增同减）/ 负相关（此消彼长）
                  - 可信度：基于数据量评估结论可靠性
          2.8.5.3 示例输出
                  ```
                  🔗 相关性分析报告

                  【发现的关联】

                  ✅ 强正相关 (r=0.78)
                  运动时长 ↔ 睡眠质量
                  - 运动时长增加时，睡眠质量评分通常也更高
                  - 数据基于最近 60 天记录，可信度：高

                  ⚡ 中等负相关 (r=-0.52)
                  加班时长 ↔ 运动频率
                  - 加班较多的日子，运动频率明显下降
                  - 建议：在繁忙时期可考虑短时高效运动

                  💡 有趣发现
                  咖啡消费 ↔ 工作效率（自评）
                  - 每日 1-2 杯咖啡时效率最高，超过 3 杯反而下降

                  [查看相关性矩阵图]
                  ```
    2.8.6 智能建议
          2.8.6.1 建议类型
                  - 行为优化：基于数据的行为调整建议
                  - 目标调整：目标是否合理的评估和调整建议
                  - 习惯养成：帮助建立或改善习惯的建议
                  - 异常应对：针对检测到的异常给出建议
          2.8.6.2 建议原则
                  - 可操作：建议具体、可执行
                  - 个性化：基于用户实际数据
                  - 适度：不过度干预，尊重用户自主性
                  - 谦虚：承认 AI 分析的局限性
          2.8.6.3 示例建议格式
                  ```
                  💡 个性化建议

                  基于你最近 30 天的数据，我有以下建议：

                  1. 【运动】建议将周三设为运动日
                     - 原因：周三是你运动频率最低的一天
                     - 具体：可以尝试 20 分钟的室内运动

                  2. 【消费】设置「餐饮」类别预算提醒
                     - 原因：餐饮支出占比达 45%，高于平均水平
                     - 具体：建议每周餐饮预算控制在 ¥XXX 以内

                  3. 【目标】「今年更健康」目标进度良好 ✓
                     - 运动达标率：85%
                     - 建议：保持当前节奏即可

                  这些建议仅供参考，请根据实际情况调整。
                  ```
    2.8.7 分析响应格式
          2.8.7.1 响应结构
                  - 标题：分析类型和时间范围
                  - 核心发现：3-5 条关键洞察
                  - 详细数据：支撑发现的数据（可折叠）
                  - 可视化：相关图表（由前端工具 Agent 渲染）
                  - 建议：可操作的改进建议
                  - 免责声明：说明 AI 分析的局限性
          2.8.7.2 图表配合
                  - 分析结果可自动调用前端工具 Agent 渲染图表
                  - 常用图表：
                    - 趋势分析 → 折线图
                    - 异常检测 → 带标注的折线图
                    - 相关性 → 散点图、热力矩阵
                    - 分布分析 → 柱状图、饼图
    2.8.8 分析数据要求
          - 最小数据量：趋势分析需至少 7 天数据，相关性分析需至少 30 天
          - 数据不足时：提示用户积累更多数据，给出预估时间
          - 数据质量：提醒用户数据完整性影响分析准确性

    2.9 前端工具 Agent
    2.8.1 可渲染工具
    | 工具类型 | 触发示例 | 渲染内容 |
    |---------|---------|---------|
    | 趋势图表 | 展示本月支出趋势 | 折线图/柱状图 |
    | 热力图 | 看看我的运动热力图 | GitHub 风格热力图 |
    | 目标进度 | 目标完成情况 | 进度卡片组 |
    | 数据表格 | 列出本周所有记录 | 可交互表格 |
    | 对比图 | 对比本月和上月支出 | 双柱状图 |
    2.8.2 渲染协议 - Agent 返回结构化渲染指令
    `typescript
          interface RenderCommand {
            type: "chart" | "heatmap" | "progress" | "table" | "comparison"
            config: ChartConfig | HeatmapConfig | ...
            data: any[]
            title: string
            description?: string
          }
          `
    2.8.3 交互能力 - 图表：悬停 tooltip、缩放、时间范围调整 - 表格：排序、筛选、分页、点击编辑 - 进度：点击展开详情
    2.8.4 跳转链接 - 渲染内容底部提供「在 Dashboard 查看完整版」链接

    2.10 对话界面设计
    2.9.1 布局 - 全屏对话布局，类似 ChatGPT - 顶部：对话标题 + 菜单 - 中部：对话消息区（可滚动） - 底部：输入区（固定）
    2.9.2 消息气泡 - 用户消息：右对齐，深灰背景 - AI 消息：左对齐，带矩阵绿左边框 - 系统消息：居中，浅色背景
    2.9.3 输入区 - 多行文本输入框 - 功能按钮： - 语音输入（麦克风图标） - 图片上传（图片图标） - 发送按钮 - 快捷指令提示：输入 `/` 时显示指令列表
    2.9.4 流式输出 - AI 响应逐字显示（打字机效果） - 显示闪烁光标 `▌` - 渲染完成后光标消失
    2.9.5 执行状态显示 - 默认显示：「思考中...」（简化） - 可点击展开查看详细步骤： - ✓ 识别意图：行为记录 - ✓ 匹配行为定义：跑步 - → 提取 metadata... - 步骤使用复选框 + 动画指示进度

    2.11 输入方式
    2.10.1 文字输入 - 支持多行输入 - Enter 发送，Shift+Enter 换行 - 支持粘贴文字
    2.10.2 语音输入 - 点击麦克风按钮开始录音 - 录音中显示波形动画 - 使用 Web Speech API 或 Whisper 转文字 - 转写结果填入输入框，用户可编辑后发送
    2.10.3 图片输入 - 支持上传图片（如账单截图、运动记录截图） - 支持拖拽上传 - 支持粘贴图片 - 图片预览 + 移除按钮 - 发送后由多模态 LLM 解析图片内容 - 解析结果用于行为记录（如从账单提取支出信息）

    2.12 对话历史管理
    2.11.1 持久化存储 - 所有对话存储到 Supabase - 包含：消息内容、时间戳、Agent 调用记录
    2.11.2 历史列表 - 左侧边栏显示历史对话（移动端通过菜单打开） - 分组方式： - 按时间：今天 / 昨天 / 本周 / 更早 - 按主题：AI 自动总结对话主题作为标题 - 支持搜索历史对话
    2.11.3 对话操作 - 新建对话 - 删除对话 - 重命名对话标题 - 导出对话（可选）
    2.11.4 上下文引用 - 同一对话内保持上下文 - 可引用之前的消息（如「修改刚才的记录」） - 上下文窗口限制：最近 20 条消息

    2.13 快捷回复
    2.12.1 触发时机 - AI 回复后根据上下文生成 2-4 个快捷回复选项
    2.12.2 快捷回复类型 - 确认类：「好的」「确认」「取消」 - 追问类：「详细说说」「还有吗」 - 操作类：「再记一条」「查看图表」「编辑」
    2.12.3 显示方式 - 以可点击的 Chip/Tag 形式显示在 AI 消息下方 - 点击后自动发送该内容

    2.14 错误处理
    2.13.1 网络错误 - 显示错误提示 + 重试按钮 - 支持离线草稿保存
    2.13.2 LLM 错误 - 超时：提示并建议简化输入 - API 限流：显示等待时间 - 内容过滤：提示内容无法处理
    2.13.3 Agent 执行错误 - 数据库操作失败：提示并保留输入 - 意图识别失败：友好地请求用户换种方式表达

    2.15 API 设计
    2.14.1 消息发送
    ```typescript
    // POST /api/chat/message
    interface SendMessageRequest {
    conversationId?: string // 可选，不传则创建新对话
    content: string
    attachments?: Attachment[]
    }

                interface Attachment {
                  type: "image" | "audio"
                  url: string
                  mimeType: string
                }

                // 响应为 SSE 流
                // event: token    data: {"content": "你"}
                // event: token    data: {"content": "好"}
                // event: tool     data: {"name": "record_behavior", "status": "running"}
                // event: tool     data: {"name": "record_behavior", "status": "completed", "result": {...}}
                // event: render   data: {"type": "confirmation_card", "data": {...}}
                // event: done     data: {"messageId": "xxx"}
                ```
         2.14.2 对话管理
                ```typescript
                // GET /api/chat/conversations - 获取对话列表
                // GET /api/chat/conversations/:id - 获取对话详情
                // DELETE /api/chat/conversations/:id - 删除对话
                // PATCH /api/chat/conversations/:id - 更新对话（重命名等）
                ```
         2.14.3 语音转写
                ```typescript
                // POST /api/chat/transcribe
                interface TranscribeRequest {
                  audio: Blob
                  language?: string
                }
                interface TranscribeResponse {
                  text: string
                  confidence: number
                }
                ```

    ````

3.  用户配置模块
    3.0 页面布局 - 布局方式：分组卡片式布局 - 分组导航：顶部 Tab 或锚点快速跳转 - 移动端：卡片垂直堆叠，可折叠 - 保存机制：自动保存 + 保存成功提示

    3.1 AI 配置
    3.1.1 API Key 管理 - 平台默认 Key - 新用户默认使用平台提供的 API Key - 提供免费额度（如每月 100 次对话） - 额度用尽后提示用户配置自己的 Key - 显示当前额度使用情况（进度条 + 数字） - 自定义 Key - 用户可配置自己的 API Key - Key 输入框带显示/隐藏切换 - 支持「测试连接」验证 Key 有效性 - Key 加密存储（AES-256） - 可随时切换回平台默认 Key
    3.1.2 支持的提供商
    | 提供商 | 支持模型 | 备注 |
    |-------|---------|------|
    | OpenAI | GPT-4o, GPT-4-turbo, GPT-4, GPT-3.5-turbo | 默认推荐 GPT-4o |
    | Anthropic | Claude 3.5 Sonnet, Claude 3 Opus/Sonnet/Haiku | 推荐 Claude 3.5 |
    | Google | Gemini 1.5 Pro, Gemini 1.5 Flash | |
    | DeepSeek | DeepSeek-V3, DeepSeek-Coder | 国产高性价比 |
    | 智谱 AI | GLM-4, GLM-4-Flash | 国产 |
    | 阿里云 | Qwen-Max, Qwen-Plus, Qwen-Turbo | 通义千问 |
    | 自定义 | 用户自定义 | OpenAI 兼容 API |
    3.1.3 自定义 API 端点 - 支持配置 OpenAI 兼容的第三方 API - 配置项： - API Base URL - API Key - 模型名称 - 用例：私有部署、代理服务、其他兼容服务
    3.1.4 模型选择 - 下拉选择当前使用的模型 - 显示各模型特点： - 能力等级（基础/标准/高级） - 响应速度（快/中/慢） - 价格等级（$/$$/$$$/$$$$） - 推荐标签：「推荐」「高性价比」「最强」
    3.1.5 高级设置（可折叠） - Temperature（0-2，默认 0.7） - Max Tokens（默认 4096） - 流式输出开关（默认开启）

    3.2 主题与外观
    3.2.1 主题模式 - 深色模式（默认）：赛博朋克风格 - 浅色模式：保留赛博朋克元素但背景偏亮 - 跟随系统：自动跟随系统深色/浅色设置
    3.2.2 强调色 - 预设选项： - 矩阵绿（默认）`#00FF41` - 电光蓝 `#00D4FF` - 霓虹紫 `#BF00FF` - 警报橙 `#FF6B35` - 自定义颜色选择器
    3.2.3 动画设置 - 动画强度： - 完整：所有动画效果 - 精简：仅保留必要过渡动画 - 关闭：无障碍模式，关闭所有动画 - 单独开关： - 矩阵雨背景 - 故障效果 - 打字机效果
    3.2.4 字体设置 - 字体大小：小 / 中（默认）/ 大 / 特大 - 代码字体：JetBrains Mono / Fira Code / 系统默认

    3.3 通知设置
    3.3.1 通知渠道 - 应用内通知（默认开启） - 浏览器推送通知（需授权） - 邮件通知（可选）
    3.3.2 目标提醒 - 开关：启用/禁用目标相关通知 - 进度提醒： - 每日目标进度汇总（可设置时间，如每晚 21:00） - 目标即将达成提醒（完成度 > 90%） - 未达标提醒： - 连续 N 天未达标时提醒（可配置天数） - 提醒频率：每天 / 每周
    3.3.3 记录提醒 - 开关：启用/禁用记录提醒 - 定时提醒： - 可添加多个提醒时间点 - 每个提醒可关联特定行为类型 - 示例：每天 8:00 提醒记录体重，22:00 提醒记录当日支出 - 遗漏提醒： - 某行为连续 N 天未记录时提醒
    3.3.4 数据洞察 - 开关：启用/禁用 AI 洞察通知 - 异常模式提醒： - AI 检测到行为模式异常时通知 - 示例：「您本周支出比上周增加 50%」 - 周期性总结： - 每周/每月自动生成数据总结 - 推送总结摘要到通知
    3.3.5 免打扰 - 免打扰时段：如 23:00 - 07:00 - 免打扰日：可选择周末不提醒

    3.4 数据管理
    3.4.1 数据导出 - 导出范围： - 全部数据 - 按类型选择（行为记录/目标/随手记/对话历史） - 按时间范围 - 导出格式： - JSON：完整结构化数据，可用于导入恢复 - CSV：表格格式，便于 Excel 分析 - PDF 报告： - 包含数据统计和可视化图表 - 可选时间范围（周报/月报/年报） - 赛博朋克风格排版 - 导出操作： - 点击导出后异步生成 - 生成完成后提供下载链接 - 大数据量时发送邮件通知
    3.4.2 数据导入 - 支持导入 JSON 格式备份文件 - 导入前预览数据概要 - 冲突处理： - 跳过已存在的记录 - 覆盖已存在的记录 - 保留两者（创建副本） - 导入进度显示
    3.4.3 数据清除 - 清除选项： - 清除所有行为记录 - 清除所有目标 - 清除所有随手记 - 清除对话历史 - 清除所有数据 - 安全确认： - 输入「DELETE」确认 - 二次确认弹窗 - 清除后不可恢复提示
    3.4.4 存储用量 - 显示当前数据存储用量 - 各类型数据占比（饼图） - 如有存储限制，显示剩余空间

    3.5 账户管理
    3.5.1 个人信息 - 头像：上传自定义头像或选择默认头像 - 昵称：显示名称 - 邮箱：显示已绑定邮箱（GitHub 登录用户可绑定）
    3.5.2 密码管理 - 修改密码： - 输入当前密码 - 输入新密码（带强度检测） - 确认新密码 - GitHub 登录用户： - 可设置密码作为备用登录方式
    3.5.3 绑定邮箱 - GitHub 登录用户可绑定邮箱 - 绑定后可用邮箱密码登录 - 发送验证邮件确认
    3.5.4 登录设备 - 查看当前登录的设备列表 - 设备类型图标 - 设备名称/浏览器 - 登录时间 - 登录 IP/位置 - 当前设备标记 - 操作： - 登出指定设备 - 登出所有其他设备
    3.5.5 账户注销 - 注销前提示： - 所有数据将被永久删除 - 无法恢复 - 建议先导出数据 - 注销流程： - 输入密码确认 - 输入「DELETE MY ACCOUNT」 - 发送确认邮件 - 点击邮件链接完成注销 - 冷静期：提交注销后 7 天内可取消

    3.7 语言与地区
    3.7.1 界面语言 - 简体中文（默认） - English - 繁體中文（可选）
    3.7.2 时区设置 - 自动检测（默认） - 手动选择时区
    3.7.3 日期格式 - YYYY-MM-DD（默认） - MM/DD/YYYY - DD/MM/YYYY
    3.7.4 货币设置 - 默认货币：CNY - 可选：USD, EUR, JPY 等 - 影响支出/收入记录的默认货币

    3.9 配置界面设计
    3.9.1 页面结构
    `        ┌─────────────────────────────────────────┐
│  设置                              [X]  │
├─────────────────────────────────────────┤
│  [AI配置] [外观] [通知] [数据] [账户]   │  ← Tab 导航
├─────────────────────────────────────────┤
│  ┌─────────────────────────────────┐    │
│  │ AI 配置                    [?]  │    │  ← 卡片标题 + 帮助
│  │ ─────────────────────────────── │    │
│  │ API Key 来源                    │    │
│  │ ○ 使用平台默认 (剩余 80/100)    │    │
│  │ ○ 使用自己的 Key               │    │
│  │                                 │    │
│  │ 选择模型                        │    │
│  │ [GPT-4o            ▼] 推荐      │    │
│  │                                 │    │
│  │ ▶ 高级设置                      │    │  ← 可折叠
│  └─────────────────────────────────┘    │
│                                         │
│  ┌─────────────────────────────────┐    │
│  │ 提供商 API Key                  │    │
│  │ ─────────────────────────────── │    │
│  │ OpenAI    [••••••••••] [测试]   │    │
│  │ Anthropic [未配置    ] [添加]   │    │
│  │ ...                             │    │
│  └─────────────────────────────────┘    │
└─────────────────────────────────────────┘`
    3.9.2 交互细节 - 开关类配置：使用 Toggle Switch，即时生效 - 选择类配置：下拉选择或 Radio Button - 文本类配置：输入框 + 失焦自动保存 - 敏感操作：需二次确认
    3.9.3 状态反馈 - 保存成功：右下角 Toast 提示「已保存」 - 保存失败：显示错误信息 + 重试按钮 - 加载中：骨架屏或 Spinner

    3.10 API 设计

    ````typescript
    // GET /api/settings - 获取用户设置
    interface UserSettings {
    ai: {
    useDefaultKey: boolean
    defaultKeyUsage: { used: number, limit: number }
    customKeys: { provider: string, hasKey: boolean }[]
    selectedProvider: string
    selectedModel: string
    temperature: number
    maxTokens: number
    streamEnabled: boolean
    }
    appearance: {
    theme: "dark" | "light" | "system"
    accentColor: string
    animationLevel: "full" | "reduced" | "none"
    fontSize: "small" | "medium" | "large" | "xlarge"
    }
    notifications: {
    inApp: boolean
    push: boolean
    email: boolean
    goalReminder: GoalReminderSettings
    recordReminder: RecordReminderSettings
    insights: InsightSettings
    doNotDisturb: DoNotDisturbSettings
    }
    locale: {
    language: string
    timezone: string
    dateFormat: string
    currency: string
    }
    shortcuts: Record<string, string>
    }

         // PATCH /api/settings - 更新用户设置（部分更新）
         // POST /api/settings/api-keys/:provider - 设置 API Key
         // DELETE /api/settings/api-keys/:provider - 删除 API Key
         // POST /api/settings/api-keys/:provider/test - 测试 API Key
         // POST /api/settings/export - 发起数据导出
         // GET /api/settings/export/:jobId - 获取导出状态/下载链接
         // POST /api/settings/import - 导入数据
         // DELETE /api/settings/data - 清除数据
         ```

    ````

4.  历史记录模块
    4.0 整体设计
    4.0.1 页面结构 - 统一时间线：所有记录（行为/目标/随手记）混合展示 - 类型标签区分：每条记录带类型标签（颜色 + 图标） - 可按类型筛选：快速切换查看单一类型或全部
    4.0.2 视图切换 - 表格视图（默认）： - 信息密度高，适合快速浏览 - 列：时间、类型、名称、详情摘要、操作 - 支持列排序 - 卡片视图： - 每条记录一张卡片 - 显示完整 metadata 信息 - 适合详细查看 - 时间轴视图： - 按日期分组，垂直时间轴展示 - 适合回顾和复盘 - 视图切换按钮在页面右上角
    4.0.3 响应式适配 - 桌面端：默认表格视图 - 移动端：默认卡片视图，表格视图简化列数

    4.1 行为记录
    4.1.1 列表展示 - 表格列：
    | 列名 | 内容 |
    |-----|------|
    | 时间 | 记录时间，支持相对时间（5 分钟前）和绝对时间切换 |
    | 类型 | 一级类型图标 + 二级类型名称 |
    | 详情 | metadata 关键字段摘要（如「跑步 30 分钟」「支出 ¥50」）|
    | 操作 | 编辑、删除按钮 | - 卡片展示： - 顶部：类型标签 + 时间 - 中部：行为名称 + 完整 metadata 列表 - 底部：操作按钮 - 时间轴展示： - 左侧：时间点 - 右侧：类型图标 + 名称 + 摘要
    4.1.2 类型标签颜色
    | 一级类型 | 颜色 | 图标建议 |
    |---------|------|---------|
    | 健康 | 矩阵绿 #00FF41 | 心跳/医疗十字 |
    | 支出 | 警报橙 #FF6B35 | 钱包/信用卡 |
    | 收入 | 电光蓝 #00D4FF | 钱袋/硬币 |
    | 习惯 | 霓虹紫 #BF00FF | 循环/打卡 |
    | 其他 | 灰色 #888888 | 标签/便签 |
    4.1.3 编辑功能 - 点击编辑按钮，右侧滑出编辑面板 - 编辑面板内容： - 行为类型（只读，显示） - 记录时间（可修改） - metadata 各字段（根据 schema 动态生成表单） - 保存/取消按钮 - 保存时验证必填字段 - 保存成功后面板自动关闭，列表刷新
    4.1.4 删除功能 - 点击删除按钮，弹出确认对话框 - 对话框显示记录摘要 - 确认后永久删除，不可恢复 - 删除成功显示 Toast 提示

    4.2 目标记录
    4.2.1 列表展示 - 表格列：
    | 列名 | 内容 |
    |-----|------|
    | 状态 | 进行中/已完成/已放弃（带颜色标签）|
    | 目标名称 | 目标名称 |
    | 关联行为 | 关联的行为类型标签列表 |
    | 进度 | 迷你进度条 |
    | 创建时间 | 创建日期 |
    | 操作 | 查看、编辑、删除 | - 卡片展示： - 顶部：状态标签 + 目标名称 - 中部：关联行为列表 + 达成基准描述 - 底部：进度条 + 操作按钮
    4.2.2 目标状态
    | 状态 | 颜色 | 说明 |
    |-----|------|------|
    | 进行中 | 矩阵绿 | 当前活跃目标 |
    | 已完成 | 电光蓝 | 已达成的目标 |
    | 已放弃 | 灰色 | 用户主动放弃 |
    4.2.3 查看详情 - 点击目标卡片/行展开详情面板 - 详情内容： - 目标描述 - 关联行为及各自进度 - 达成基准详细说明 - 创建/更新时间 - 相关数据趋势图（迷你图表）
    4.2.4 编辑功能 - 侧边栏编辑面板 - 可编辑：目标名称、描述、关联行为、达成基准 - 可修改状态（进行中 → 已完成/已放弃）
    4.2.5 删除功能 - 确认对话框提示：删除目标不会删除相关行为记录 - 永久删除

    4.3 随手记记录
    4.3.1 列表展示 - 表格列：
    | 列名 | 内容 |
    |-----|------|
    | 时间 | 创建时间 |
    | 标题 | AI 生成的标题 |
    | 内容预览 | 前 50 字 + ... |
    | 标签 | 提取的标签列表 |
    | 操作 | 查看、编辑、删除 | - 卡片展示： - 顶部：标题 + 时间 - 中部：完整内容 - 底部：标签 + 操作按钮
    4.3.2 查看详情 - 点击展开完整内容 - 支持 Markdown 渲染
    4.3.3 编辑功能 - 侧边栏编辑面板 - 可编辑：标题、内容、标签 - 内容支持 Markdown 编辑
    4.3.4 删除功能 - 确认后永久删除

    4.4 搜索功能
    4.4.1 全局搜索框 - 页面顶部搜索框 - 支持搜索： - 行为名称、metadata 内容 - 目标名称、描述 - 随手记标题、内容、标签 - 搜索结果高亮匹配关键词
    4.4.2 搜索建议 - 输入时显示搜索建议 - 显示最近搜索历史 - 热门搜索词（可选）

    4.5 筛选功能
    4.5.1 基础筛选 - 类型筛选：全部 / 行为 / 目标 / 随手记 - 时间筛选： - 预设：今天 / 本周 / 本月 / 本年 - 自定义日期范围选择器
    4.5.2 高级筛选（行为记录） - 一级类型筛选：健康 / 支出 / 收入 / 习惯 / 其他 - 二级类型筛选：根据一级类型动态加载 - metadata 字段筛选： - 数值范围（如金额 100-500） - 枚举选择（如运动强度：低/中/高） - 筛选条件可叠加
    4.5.3 高级筛选（目标） - 状态筛选：进行中 / 已完成 / 已放弃 - 关联行为类型筛选
    4.5.4 高级筛选（随手记） - 标签筛选：多选
    4.5.5 筛选器 UI - 筛选按钮点击展开筛选面板 - 当前筛选条件显示为 Chip，可点击移除 - 「清除所有筛选」按钮

    4.6 排序功能
    4.6.1 排序选项 - 时间排序：最新优先（默认）/ 最早优先 - 类型排序：按类型分组 - 自定义排序：表格视图下点击列头排序
    4.6.2 排序 UI - 排序下拉选择器 - 当前排序方式指示

    4.7 快速跳转
    4.7.1 日期跳转 - 「跳转到日期」按钮 - 日历选择器快速跳转到指定日期
    4.7.2 快捷跳转 - 「今天」按钮：跳转到今日记录 - 「顶部」按钮：滚动到列表顶部

    4.8 侧边栏编辑面板
    4.8.1 面板结构
    `        ┌─────────────────────────────────┐
  │  编辑行为记录              [X]  │  ← 标题 + 关闭按钮
  ├─────────────────────────────────┤
  │  类型：[健康] 跑步              │  ← 只读信息
  ├─────────────────────────────────┤
  │  记录时间                        │
  │  [2024-01-15 10:30    📅]       │  ← 日期时间选择器
  │                                 │
  │  时长                           │
  │  [30        ] 分钟              │  ← 数值 + 单位
  │                                 │
  │  运动强度                        │
  │  ○ 低  ● 中  ○ 高               │  ← 单选
  │                                 │
  │  备注                           │
  │  [                        ]     │  ← 文本框
  │                                 │
  ├─────────────────────────────────┤
  │  [取消]              [保存修改]  │  ← 操作按钮
  └─────────────────────────────────┘`
    4.8.2 交互细节 - 从右侧滑入，宽度 400px（桌面）/ 全屏（移动） - 背景半透明遮罩，点击遮罩关闭 - ESC 键关闭 - 有未保存修改时关闭需确认
    4.8.3 表单验证 - 必填字段标记 \* - 实时验证，错误信息显示在字段下方 - 保存按钮在验证通过前禁用

    4.9 空状态设计
    4.9.1 无记录时 - 显示空状态插画（赛博朋克风格） - 提示文字：「还没有记录，开始你的第一条吧」 - 快捷操作按钮：「去记录」「去对话」
    4.9.2 搜索无结果 - 提示：「没有找到匹配的记录」 - 建议：尝试其他关键词或清除筛选条件
    4.9.3 筛选无结果 - 提示：「当前筛选条件下没有记录」 - 「清除筛选」按钮

    4.10 分页与加载
    4.10.1 分页策略 - 默认每页 20 条 - 支持切换：20 / 50 / 100 条每页
    4.10.2 加载方式 - 桌面端：传统分页（页码导航） - 移动端：无限滚动（滚动到底部自动加载）
    4.10.3 加载状态 - 首次加载：骨架屏 - 翻页/加载更多：底部加载指示器 - 加载失败：错误提示 + 重试按钮

    4.11 页面设计
    4.11.1 页面结构（桌面端）
    `          ┌───────────────────────────────────────────────────────┐
    │  历史记录                                              │
    ├───────────────────────────────────────────────────────┤
    │  [🔍 搜索...]                    [筛选▼] [排序▼] [≡/▦/⋮]│
    │  ┌─────────────────────────────────────────────────┐  │
    │  │ [全部] [行为] [目标] [随手记]     跳转: [今天] [📅]│  │
    │  └─────────────────────────────────────────────────┘  │
    │  当前筛选: [本月 ×] [健康 ×]           共 42 条记录    │
    ├───────────────────────────────────────────────────────┤
    │  ┌──────┬────────┬──────────────┬──────┬───────┐     │
    │  │ 时间 │ 类型   │ 详情         │ 标签 │ 操作  │     │
    │  ├──────┼────────┼──────────────┼──────┼───────┤     │
    │  │10:30 │🏃跑步  │ 30分钟 中强度│      │ ✏️ 🗑 │     │
    │  │09:15 │💰支出  │ ¥35 早餐     │      │ ✏️ 🗑 │     │
    │  │昨天  │🎯目标  │ 今年更健康   │进行中│ 👁 ✏️ │     │
    │  │...   │...     │ ...          │...   │ ...   │     │
    │  └──────┴────────┴──────────────┴──────┴───────┘     │
    │                                                       │
    │  ◀ 1 2 3 ... 10 ▶              每页 [20▼] 条          │
    └───────────────────────────────────────────────────────┘
 `
    4.11.2 视觉风格 - 表格：深色背景 + 细边框 + 悬停高亮 - 卡片：故障效果边框 + 发光效果 - 时间轴：左侧霓虹色时间线 + 右侧卡片

    4.12 API 设计

    ````typescript
    // 获取历史记录列表
    // GET /api/history
    interface HistoryListRequest {
    type?: "behavior" | "goal" | "note" | "all"
    startDate?: string
    endDate?: string
    behaviorCategory?: string // 一级类型
    behaviorType?: string // 二级类型
    goalStatus?: "active" | "completed" | "abandoned"
    noteTags?: string[]
    search?: string
    sortBy?: "time" | "type"
    sortOrder?: "asc" | "desc"
    page?: number
    pageSize?: number
    }

         interface HistoryListResponse {
           items: HistoryItem[]
           total: number
           page: number
           pageSize: number
           hasMore: boolean
         }

         interface HistoryItem {
           id: string
           type: "behavior" | "goal" | "note"
           createdAt: string
           updatedAt: string
           data: BehaviorRecord | Goal | Note
         }

         // 获取单条记录详情
         // GET /api/history/:type/:id

         // 更新记录
         // PATCH /api/history/:type/:id

         // 删除记录
         // DELETE /api/history/:type/:id
         ```

    ````

5.  可视化模块
    5.0 通用规范 - 展示位置：独立 Dashboard 页面 + chatbot 内通过前端工具 agent 渲染 - 时间选择器：支持预设（今日/本周/本月/本年）+ 自定义起止日期 - 响应式：移动端垂直堆叠，桌面端网格布局 - 赛博朋克风格：霓虹配色、发光边框、故障艺术动效 - 图表库：统一使用支持主题定制的图表库（如 ECharts/Recharts）
    5.1 综合仪表盘（Dashboard）
    5.1.1 概览卡片区 - 今日行为统计：今日已记录行为数量，按一级类型分布（迷你饼图） - 目标达成率：当前活跃目标的整体完成百分比，环形进度条 - 连续打卡天数：最长连续记录天数，支持选择具体行为查看 - 本周/月总结：周期内关键指标对比（如支出总额、运动次数等）
    5.1.2 快捷入口 - 一键跳转到对应的历史记录/表单 - 卡片支持拖拽排序（用户个性化布局）
    5.2 行为趋势图
    5.2.1 折线图（主要） - X 轴：时间（日/周/月粒度自动聚合） - Y 轴：行为数值（次数/金额/时长等，根据 metadata 单位） - 支持多行为叠加对比（最多 5 条曲线） - 悬停显示详细数据 tooltip
    5.2.2 柱状图 - 用于离散数据对比（如各类支出占比） - 支持堆叠柱状图展示分类构成
    5.2.3 饼图/环形图 - 用于单周期内的分类占比分析
    5.3 热力图（GitHub 风格）
    5.3.1 维度切换 - 单行为模式：展示某一行为每日执行频率/数值，颜色深浅表示强度 - 整体活跃度模式：展示每日总记录数
    5.3.2 交互 - 点击单元格跳转到当日历史记录 - 悬停显示当日统计摘要
    5.3.3 时间范围 - 默认展示近 365 天 - 支持按年切换
    5.4 目标进度可视化
    5.4.1 目标卡片 - 每个目标一张卡片，显示名称、关联行为、达成基准 - 环形/条形进度指示器
    5.4.2 趋势与基准线 - 折线图展示关联行为趋势 - 叠加目标基准线（如"日均运动 > 20 分钟"的基准线） - 达标/未达标区域用不同颜色填充
    5.4.3 周期达成率 - 日/周/月维度的达标天数统计
    5.5 对比分析
    5.5.1 多行为对比 - 选择 2-5 个行为，同一时间维度下曲线叠加 - 支持双 Y 轴（当单位不同时）
    5.5.2 周期对比 - 同一行为的本周 vs 上周、本月 vs 上月对比
    5.5.3 目标对比 - 多目标完成率横向对比柱状图
    5.6 chatbot 内嵌渲染
    5.6.1 触发方式 - 前端工具 agent 识别用户意图后渲染 - 支持的指令示例："展示我本月的支出趋势"、"看看我的运动热力图"
    5.6.2 渲染规范 - 图表嵌入对话流中，宽度自适应 - 提供"在 Dashboard 中查看"的跳转链接 - 轻量模式：优先加载关键数据，复杂图表延迟渲染
6.  表单模块
    6.0 模块定位 - 核心目的：在 AI 不可用时（无 API Key / 额度用尽 / 网络问题）提供传统表单方式记录 - 与 Chatbot 的关系：功能互补，表单是 AI 记录的降级方案和补充 - 使用场景： - 用户未配置 API Key - AI 额度用尽 - 需要精确控制字段值 - 批量录入历史数据 - 偏好传统表单交互的用户

    6.1 入口设计
    6.1.1 悬浮操作按钮 (FAB) - 位置：屏幕右下角固定悬浮 - 样式：圆形按钮，矩阵绿背景，「+」图标 - 动画：点击展开为扇形菜单 - 展开选项：
    | 图标 | 标签 | 功能 |
    |-----|------|------|
    | 📝 | 记录行为 | 打开行为记录表单 |
    | 🎯 | 新建目标 | 打开目标表单 |
    | 💭 | 随手记 | 打开随手记表单 | - 收起：点击空白区域或再次点击主按钮
    6.1.2 显示规则 - 在以下页面显示：Dashboard、历史记录、设置 - 在 Chatbot 页面隐藏（避免与输入框冲突） - 移动端：底部居中或右下角 - 桌面端：右下角

    6.2 侧边栏表单面板
    6.2.1 面板结构
    `          ┌────────────────────────────────────┐
          │  新建行为记录                 [X]  │ ← 标题 + 关闭
          ├────────────────────────────────────┤
          │  选择行为类型                       │
          │  ┌──────────────────────────────┐  │
          │  │ 🔍 搜索或创建新行为...       │  │ ← 搜索框
          │  └──────────────────────────────┘  │
          │                                    │
          │  常用行为                          │
          │  [🏃 跑步] [💰 支出] [😴 睡眠]     │ ← 快捷选择
          │                                    │
          │  ──────── 或选择分类 ────────      │
          │  [健康▼] [支出▼] [收入▼] [习惯▼]  │ ← 分类筛选
          │                                    │
          ├────────────────────────────────────┤
          │  ↓ 选择行为后显示表单字段 ↓        │
          ├────────────────────────────────────┤
          │  记录时间                          │
          │  [2024-01-15 10:30        📅]     │
          │                                    │
          │  时长 *                            │
          │  [30        ] [分钟 ▼]            │
          │                                    │
          │  强度                              │
          │  ○ 低  ● 中  ○ 高                  │
          │                                    │
          │  备注                              │
          │  [                           ]    │
          │                                    │
          ├────────────────────────────────────┤
          │  [取消]                   [保存]   │
          └────────────────────────────────────┘
         `
    6.2.2 面板交互 - 从右侧滑入，宽度 420px（桌面）/ 全屏（移动） - 背景半透明遮罩 - ESC 键关闭（有内容时需确认） - 点击遮罩关闭（有内容时需确认）
    6.2.3 关闭确认 - 有未保存内容时弹出确认：「有未保存的内容，确定关闭吗？」 - 选项：「继续编辑」「放弃」

    6.3 行为记录表单
    6.3.1 行为选择 - 搜索框：输入关键词搜索已有行为定义 - 常用行为：显示最近 5 个使用过的行为（可点击直接选择） - 分类筛选：按一级类型筛选行为列表 - 创建新行为：搜索无结果时显示「创建新行为：XXX」
    6.3.2 动态表单生成 - 选择行为后，根据该行为的 metadata schema 动态生成表单字段 - 字段顺序按 schema 定义顺序 - 必填字段标记 \*
    6.3.3 通用字段 - 记录时间：默认当前时间，可修改 - 备注：可选文本框
    6.3.4 快捷记录 - 选择常用行为后，预填上次记录的值 - 只需确认/微调即可快速保存
    6.3.5 保存流程 - 验证必填字段 - 保存到数据库 - 显示成功 Toast - 询问「继续记录同类行为？」或自动关闭

    6.4 行为定义（在记录时创建）
    6.4.1 触发方式 - 在行为选择搜索框中输入不存在的行为名称 - 点击「创建新行为：XXX」
    6.4.2 创建流程
    `          ┌────────────────────────────────────┐
          │  创建新行为定义                    │
          ├────────────────────────────────────┤
          │  行为名称                          │
          │  [跑步                       ]    │
          │                                    │
          │  所属分类 *                        │
          │  ○ 健康  ○ 支出  ○ 收入           │
          │  ○ 习惯  ○ 其他                   │
          │                                    │
          │  ──────── 配置记录字段 ────────    │
          │                                    │
          │  [+ 添加字段]                      │
          │                                    │
          │  ┌──────────────────────────────┐  │
          │  │ 字段1: 时长                  │  │
          │  │ 类型: [数字+单位 ▼]          │  │
          │  │ 单位选项: 分钟, 小时         │  │
          │  │ 必填: [✓]                    │  │
          │  │                    [删除]    │  │
          │  └──────────────────────────────┘  │
          │                                    │
          │  [+ 添加字段]                      │
          │                                    │
          ├────────────────────────────────────┤
          │  [取消]           [创建并继续记录] │
          └────────────────────────────────────┘
         `
    6.4.3 字段类型
    | 类型 | 说明 | 配置项 |
    |-----|------|-------|
    | 数字 | 整数或小数 | 小数位数、最小值、最大值 |
    | 数字+单位 | 数字带单位选择 | 可选单位列表（如：分钟、小时） |
    | 文本 | 单行文本 | 最大长度 |
    | 多行文本 | 多行文本框 | 最大长度 |
    | 单选 | 单选按钮组 | 选项列表 |
    | 多选 | 复选框组 | 选项列表 |
    | 日期 | 日期选择 | 默认今天 |
    | 时间 | 时间选择 | 默认当前时间 |
    | 日期时间 | 日期+时间 | 默认当前 |
    | 评分 | 1-5 星或 1-10 分 | 最大值 |
    | 货币 | 金额输入 | 货币类型（继承用户设置） |
    6.4.4 字段配置 - 字段名称：必填 - 字段类型：必选 - 是否必填：开关 - 默认值：可选 - 提示文字：可选

    6.5 表单模板
    6.5.1 预设模板
    | 模板名称 | 分类 | 包含字段 |
    |---------|------|---------|
    | 跑步 | 健康 | 时长(分钟)、距离(公里)、配速、心率(可选) |
    | 力量训练 | 健康 | 训练部位(单选)、时长(分钟)、组数 |
    | 睡眠 | 健康 | 入睡时间、起床时间、睡眠质量(评分) |
    | 体重 | 健康 | 体重(kg，1 位小数) |
    | 日常支出 | 支出 | 金额、分类(单选)、商家(可选)、备注 |
    | 餐饮 | 支出 | 金额、餐次(早/中/晚/夜宵)、备注 |
    | 交通 | 支出 | 金额、交通方式(单选)、起点、终点 |
    | 工资收入 | 收入 | 金额、类型(工资/奖金/其他) |
    | 喝水 | 习惯 | 水量(ml) |
    | 阅读 | 习惯 | 时长(分钟)、书名(可选) |
    6.5.2 使用模板 - 创建行为时可选择「从模板创建」 - 选择模板后自动填充字段配置 - 可在模板基础上修改
    6.5.3 保存为模板 - 用户可将自定义行为保存为个人模板 - 便于复用

    6.6 目标表单
    6.6.1 表单结构
    `          ┌────────────────────────────────────┐
          │  新建目标                     [X]  │
          ├────────────────────────────────────┤
          │  目标名称 *                        │
          │  [今年更健康                  ]    │
          │                                    │
          │  目标描述                          │
          │  [                           ]    │
          │  [                           ]    │
          │                                    │
          │  目标分类                          │
          │  [健康 ▼]                         │
          │                                    │
          │  时间范围                          │
          │  ○ 长期目标（无截止日期）          │
          │  ● 限期目标                        │
          │    开始: [2024-01-01] 结束: [2024-12-31] │
          │                                    │
          │  ──────── 关联行为 ────────        │
          │                                    │
          │  [+ 添加关联行为]                  │
          │                                    │
          │  ┌──────────────────────────────┐  │
          │  │ 🏃 跑步                      │  │
          │  │ 达成条件:                    │  │
          │  │ [每周 ▼] [次数 ▼] [>= ▼] [3]│  │
          │  │                    [删除]    │  │
          │  └──────────────────────────────┘  │
          │                                    │
          │  [+ 添加关联行为]                  │
          │                                    │
          ├────────────────────────────────────┤
          │  [取消]                   [创建]   │
          └────────────────────────────────────┘
         `
    6.6.2 关联行为配置 - 选择已有行为定义 - 配置达成条件： - 周期：每日 / 每周 / 每月 - 指标：次数 / 总时长 / 总金额 / 平均值 - 运算符：>= / > / <= / < / == - 目标值：数字 - 可添加多个关联行为
    6.6.3 目标编辑 - 从历史记录进入编辑 - 可修改所有字段 - 可修改状态（进行中 → 已完成/已放弃）

    6.7 随手记表单
    6.7.1 表单结构
    `          ┌────────────────────────────────────┐
          │  新建随手记                   [X]  │
          ├────────────────────────────────────┤
          │  标题（可选，不填则自动生成）      │
          │  [                           ]    │
          │                                    │
          │  内容 *                            │
          │  ┌──────────────────────────────┐  │
          │  │                              │  │
          │  │   支持 Markdown 格式...      │  │
          │  │                              │  │
          │  │                              │  │
          │  └──────────────────────────────┘  │
          │  [B] [I] [链接] [列表] [代码]      │ ← 格式工具栏
          │                                    │
          │  标签（可选）                      │
          │  [想法] [工作] [+]                 │ ← 已选标签
          │  [输入或选择标签...]               │
          │                                    │
          ├────────────────────────────────────┤
          │  [取消]                   [保存]   │
          └────────────────────────────────────┘
         `
    6.7.2 内容编辑 - 支持 Markdown 格式 - 提供简易格式工具栏 - 实时预览（可选）
    6.7.3 标签管理 - 显示已有标签供选择 - 可输入新标签 - 标签以 Chip 形式展示
    6.7.4 自动标题 - 不填标题时，保存后由系统生成 - 生成规则：取内容前 20 字或 AI 总结（如可用）

    6.8 表单验证
    6.8.1 验证规则 - 必填字段不能为空 - 数字字段在范围内 - 日期格式正确 - 自定义验证规则（如结束日期 > 开始日期）
    6.8.2 错误展示 - 字段下方显示红色错误信息 - 错误字段边框变红 - 提交时滚动到第一个错误字段
    6.8.3 实时验证 - 失焦时验证 - 输入时清除错误状态

    6.9 表单状态
    6.9.1 加载状态 - 加载行为定义时显示骨架屏
    6.9.2 提交状态 - 提交按钮显示 loading - 禁用表单交互
    6.9.3 成功状态 - Toast 提示「保存成功」 - 可选：继续记录 / 关闭
    6.9.4 错误状态 - Toast 提示错误信息 - 保留表单内容，可重试

    6.10 AI 协助（可选增强） - 当 AI 可用时，表单可获得增强功能： - 智能建议：根据输入内容建议行为类型 - 自动填充：根据历史数据建议默认值 - 标题生成：随手记自动生成标题 - 这些功能在 AI 不可用时优雅降级

    6.11 与 Chatbot 的协同
    6.11.1 互相跳转 - Chatbot 中：「用表单记录」按钮跳转到表单 - 表单中：「用 AI 记录」按钮跳转到 Chatbot（如 AI 可用）
    6.11.2 数据一致 - 两种方式创建的数据结构完全相同 - 在历史记录中统一展示
    6.11.3 使用建议 - AI 可用时：推荐使用 Chatbot（更自然、更快） - AI 不可用时：自动引导使用表单 - 需要精确控制时：建议使用表单

    6.12 API 设计
    ```typescript
    // 行为定义相关
    // GET /api/behavior-definitions - 获取行为定义列表
    // POST /api/behavior-definitions - 创建行为定义
    // PATCH /api/behavior-definitions/:id - 更新行为定义
    // DELETE /api/behavior-definitions/:id - 删除行为定义

         // 行为定义结构
         interface BehaviorDefinition {
           id: string
           name: string
           category: "health" | "expense" | "income" | "habit" | "other"
           icon?: string
           metadataSchema: MetadataField[]
           usageCount: number  // 用于排序常用行为
           createdAt: string
           updatedAt: string
         }

         interface MetadataField {
           name: string
           key: string
           type: "number" | "number_unit" | "text" | "textarea" | "select" | "multiselect" | "date" | "time" | "datetime" | "rating" | "currency"
           required: boolean
           config: {
             // 数字类型
             min?: number
             max?: number
             decimals?: number
             // 数字+单位
             units?: string[]
             defaultUnit?: string
             // 选择类型
             options?: { label: string, value: string }[]
             // 评分类型
             maxRating?: number
             // 货币类型
             currency?: string
             // 通用
             defaultValue?: any
             placeholder?: string
           }
         }

         // 行为记录相关
         // POST /api/behaviors - 创建行为记录
         interface CreateBehaviorRequest {
           definitionId: string
           metadata: Record<string, any>
           recordedAt: string
           note?: string
         }

         // 目标相关
         // POST /api/goals - 创建目标
         interface CreateGoalRequest {
           name: string
           description?: string
           category: string
           startDate: string
           endDate?: string
           criteria: GoalCriteria[]
         }

         // 随手记相关
         // POST /api/notes - 创建随手记
         interface CreateNoteRequest {
           title?: string
           content: string
           tags?: string[]
         }
         ```

# UI

## 1. 前端路由设计

### 1.1 路由结构

```
/                           # 落地页（未登录）
├── /login                  # 登录页
├── /register               # 注册页
├── /reset-password         # 密码重置
├── /demo                   # 访客体验
│
├── /dashboard              # 仪表盘（默认首页，需登录）
├── /chat                   # AI 对话
│   └── /chat/:conversationId   # 特定对话
├── /history                # 历史记录
│   ├── /history/behaviors  # 行为记录（可选子路由）
│   ├── /history/goals      # 目标记录
│   └── /history/notes      # 随手记
└── /settings               # 设置（侧边栏渲染，不占用路由）
```

### 1.2 路由配置

| 路由              | 页面名称 | 权限   | 布局     | 默认重定向            |
| ----------------- | -------- | ------ | -------- | --------------------- |
| `/`               | 落地页   | 公开   | 无导航   | 已登录→`/dashboard`   |
| `/login`          | 登录页   | 公开   | 无导航   | 已登录→`/dashboard`   |
| `/register`       | 注册页   | 公开   | 无导航   | 已登录→`/dashboard`   |
| `/reset-password` | 密码重置 | 公开   | 无导航   | -                     |
| `/demo`           | 访客体验 | 公开   | 简化导航 | -                     |
| `/dashboard`      | 仪表盘   | 需登录 | 完整导航 | -                     |
| `/chat`           | AI 对话  | 需登录 | 完整导航 | -                     |
| `/chat/:id`       | 特定对话 | 需登录 | 完整导航 | -                     |
| `/history`        | 历史记录 | 需登录 | 完整导航 | -                     |
| `*`               | 404 页面 | 公开   | 无导航   | -                     |

### 1.3 路由守卫

```typescript
// 路由守卫逻辑
const routeGuard = {
  // 未登录访问受保护页面
  unauthenticated: {
    redirect: "/login",
    preserveRedirect: true, // /login?redirect=/original-path
  },
  // 已登录访问登录页
  authenticated: {
    redirect: "/dashboard",
  },
  // 登录成功后
  afterLogin: {
    redirect: "query.redirect || /dashboard",
  },
};
```

## 2. 布局系统

### 2.1 布局类型

| 布局         | 适用页面                       | 组成                               |
| ------------ | ------------------------------ | ---------------------------------- |
| 无导航布局   | 落地页、登录、注册、重置密码   | 纯内容，无导航元素                 |
| 简化导航布局 | 访客体验                       | 顶部简化导航（仅 Logo + 登录按钮） |
| 完整导航布局 | Dashboard、Chat、History       | 顶部导航 + 内容区 + 悬浮按钮       |

### 2.2 桌面端布局（>1024px）

```
┌─────────────────────────────────────────────────────────────────┐
│  [Logo]    [Dashboard] [对话] [历史]           [通知🔔] [头像▼] │ ← 顶部导航
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                                                                 │
│                        页面内容区                                │
│                                                                 │
│                                                                 │
│                                                         [+]     │ ← 悬浮按钮
└─────────────────────────────────────────────────────────────────┘
```

**顶部导航栏组成：**

- 左侧：Logo（点击回首页）
- 中间：主导航项（Dashboard / 对话 / 历史）
- 右侧：通知图标 + 用户头像下拉菜单

**用户头像下拉菜单：**

- 用户昵称 + 邮箱
- 设置（打开设置侧边栏）
- 退出登录

### 2.3 移动端布局（<640px）

```
┌─────────────────────────────────┐
│  [☰]    NEO-LOG        [🔔][👤]│ ← 顶部栏
├─────────────────────────────────┤
│                                 │
│                                 │
│          页面内容区              │
│                                 │
│                                 │
├─────────────────────────────────┤
│  [📊]    [💬]    [+]    [📋]   │ ← 底部 Tab
│ Dashboard  对话   新建   历史   │
└─────────────────────────────────┘
```

**顶部栏组成：**

- 左侧：汉堡菜单图标
- 中间：Logo 或页面标题
- 右侧：通知 + 头像

**底部 Tab 栏：**

| 图标 | 标签      | 路由         |
| ---- | --------- | ------------ |
| 📊   | Dashboard | `/dashboard` |
| 💬   | 对话      | `/chat`      |
| ➕   | 新建      | 展开 FAB 菜单 |
| 📋   | 历史      | `/history`   |

**汉堡菜单内容：**

- 用户信息卡片
- 导航链接（与底部 Tab 重复，便于单手操作）
- 设置入口
- 退出登录

### 2.4 平板端布局（640-1024px）

- 使用桌面端顶部导航
- 内容区宽度自适应
- 悬浮按钮保持右下角

## 3. 公共模块

### 3.1 顶部导航栏（桌面端）

```
组件: TopNavbar
高度: 64px
背景: #0A0A0A + 底部 1px 边框 rgba(0, 255, 65, 0.2)
位置: 固定顶部

结构:
┌────────────────────────────────────────────────────────────┐
│ [NEO-LOG]  │  [Dashboard] [对话] [历史记录]  │  [🔔] [👤▼] │
│   Logo     │         导航链接               │   工具区    │
└────────────────────────────────────────────────────────────┘

导航链接:
- 当前页面: 文字矩阵绿 + 底部 2px 指示条
- 非当前页面: 文字灰白色
- 悬停: 文字矩阵绿 + 轻微发光

Logo:
- 像素字体
- 悬停时故障效果闪烁
```

### 3.2 底部 Tab 栏（移动端）

```
组件: BottomTabBar
高度: 64px + 安全区域
背景: #0A0A0A + 顶部 1px 边框
位置: 固定底部

Tab 项:
- 图标 + 文字标签
- 当前项: 矩阵绿
- 非当前项: 灰色
- 中间「新建」按钮突出显示（圆形背景）
```

### 3.3 汉堡菜单侧边栏（移动端）

```
组件: MobileDrawer
宽度: 280px
位置: 从左侧滑入
背景: #1A1A1A

结构:
┌──────────────────────────┐
│  ┌────────────────────┐  │
│  │ [头像]              │  │
│  │ 用户昵称            │  │
│  │ user@email.com     │  │
│  └────────────────────┘  │
│                          │
│  ────────────────────    │
│                          │
│  📊 Dashboard            │
│  💬 AI 对话              │
│  📋 历史记录             │
│                          │
│  ────────────────────    │
│                          │
│  ⚙️ 设置                 │
│  🚪 退出登录             │
└──────────────────────────┘

动画: 从左侧滑入 300ms ease-out
遮罩: 半透明黑色，点击关闭
```

### 3.4 设置侧边栏

```
组件: SettingsDrawer
宽度: 480px（桌面）/ 全屏（移动）
位置: 从右侧滑入
背景: #1A1A1A

触发方式:
- 点击头像菜单中的「设置」
- 键盘快捷键 Ctrl/Cmd + ,

内容: 参见用户配置模块（3.9 配置界面设计）

动画: 从右侧滑入 300ms ease-out
关闭: 点击遮罩 / ESC 键 / 关闭按钮
```

### 3.5 悬浮操作按钮 (FAB)

```
组件: FloatingActionButton
位置: 右下角，距边缘 24px
大小: 56px 圆形

样式:
- 背景: 矩阵绿渐变
- 图标: 白色 + 图标
- 阴影: 发光效果

展开动画:
- 主按钮旋转 45°（+ 变 ×）
- 子按钮扇形展开
- 展开顺序: 从下往上依次出现

子按钮:
- 📝 记录行为（距主按钮 70px，角度 90°）
- 🎯 新建目标（距主按钮 70px，角度 135°）
- 💭 随手记（距主按钮 70px，角度 180°）
```

### 3.6 通知中心

```
组件: NotificationCenter
触发: 点击顶部导航的通知图标

桌面端: 下拉面板
┌────────────────────────────┐
│  通知                [全部已读] │
├────────────────────────────┤
│  🔴 目标提醒              刚刚 │
│  「今年更健康」今日未达标      │
├────────────────────────────┤
│  🔵 数据洞察            2小时前│
│  本周支出较上周增加 30%        │
├────────────────────────────┤
│         查看全部通知 →        │
└────────────────────────────┘

移动端: 全屏页面
- 通知列表
- 下拉刷新
- 滑动删除
```

### 3.7 Toast 提示

```
组件: Toast
位置: 顶部居中（桌面）/ 顶部安全区下方（移动）
持续时间: 3 秒（可配置）

类型:
- 成功: 矩阵绿左边框
- 错误: 霓虹红左边框
- 警告: 警报橙左边框
- 信息: 电光蓝左边框

动画: 从上方滑入 + 淡入
```

### 3.8 确认对话框

```
组件: ConfirmDialog
位置: 屏幕居中
背景: 半透明遮罩

结构:
┌────────────────────────────┐
│  确认删除                   │
├────────────────────────────┤
│                            │
│  确定要删除这条记录吗？       │
│  此操作不可恢复。            │
│                            │
├────────────────────────────┤
│  [取消]          [确认删除]  │
└────────────────────────────┘

危险操作: 确认按钮为红色
普通确认: 确认按钮为矩阵绿
```

### 3.9 加载状态

```
全局加载:
- 矩阵雨效果覆盖全屏
- 中心显示 Logo + 进度百分比

局部加载:
- 骨架屏: 深灰色块 + 闪烁动画
- 按钮加载: 按钮内显示旋转 Spinner
- 列表加载: 底部显示加载指示器
```

### 3.10 空状态

```
组件: EmptyState

结构:
┌────────────────────────────┐
│                            │
│        [赛博风格插画]       │
│                            │
│      还没有任何记录         │
│   开始记录你的第一条数据吧   │
│                            │
│     [开始记录] [了解更多]   │
│                            │
└────────────────────────────┘

插画风格: 赛博朋克线条画 + 发光效果
```

## 4. 页面设计

### 4.1 落地页 (/)

**目的**: 产品介绍，引导注册

**布局**: 无导航，全屏滚动页面

**结构**:

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                        [矩阵雨背景]                          │
│                                                             │
│                        NEO-LOG                              │
│                Log your life. Hack your future.             │
│                                                             │
│                   [开始使用]  [体验 Demo]                    │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐                     │
│  │ AI 记录  │  │ 可视化  │  │ 智能分析 │                     │
│  │ 自然语言 │  │ 数据趋势│  │ 洞察建议 │     功能特点        │
│  └─────────┘  └─────────┘  └─────────┘                     │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                     [产品截图/动画演示]                       │
│                                                             │
│                    灵活的行为追踪系统                         │
│              支持健康、财务、习惯等多种场景                    │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      准备好了吗？                            │
│                                                             │
│                       [免费开始]                             │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  NEO-LOG    关于    隐私政策    服务条款    GitHub           │
│                    © 2024 NEO-LOG                           │
└─────────────────────────────────────────────────────────────┘
```

**动画效果**:

- 首屏矩阵雨背景
- Logo 发光 + 故障效果
- 滚动时元素渐入
- 功能卡片悬停发光

### 4.2 登录页 (/login)

**布局**: 全屏，矩阵雨背景 + 居中登录卡片

**详细设计**: 参见登录模块 1.7

### 4.3 Dashboard (/dashboard)

**目的**: 数据概览，快速了解当前状态

**布局**: 完整导航 + 卡片网格

**结构**:

```
┌─────────────────────────────────────────────────────────────┐
│  [顶部导航栏]                                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  早上好，用户名 👋                     2024年1月15日 周一     │
│                                                             │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │ 今日行为     │ │ 目标达成率   │ │ 连续打卡     │           │
│  │     5       │ │    78%     │ │   12 天     │  概览卡片  │
│  │ 较昨日 +2   │ │   [进度条]  │ │   🏃 跑步   │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                                                       │ │
│  │                   本周行为趋势                         │ │
│  │                    [折线图]                           │ │
│  │                                                       │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌──────────────────────┐ ┌──────────────────────┐         │
│  │ 目标进度              │ │ 最近记录              │         │
│  │ ┌──────────────────┐ │ │ 10:30 🏃 跑步 30分钟 │         │
│  │ │ 今年更健康   78% │ │ │ 09:15 💰 支出 ¥35   │         │
│  │ │ [━━━━━━━━░░]    │ │ │ 昨天  😴 睡眠 7.5h  │         │
│  │ └──────────────────┘ │ │         [查看全部→]  │         │
│  └──────────────────────┘ └──────────────────────┘         │
│                                                       [+]   │
└─────────────────────────────────────────────────────────────┘
```

**卡片布局**:

- 桌面端: 3 列概览卡片 + 2 列下方卡片
- 平板端: 2 列
- 移动端: 1 列，垂直堆叠

**交互**:

- 概览卡片点击可展开详情
- 图表支持时间范围切换
- 卡片支持拖拽排序（用户自定义布局）

### 4.4 AI 对话页 (/chat)

**目的**: AI 驱动的自然语言交互

**布局**: 完整导航 + 对话界面

**结构（桌面端）**:

```
┌─────────────────────────────────────────────────────────────┐
│  [顶部导航栏]                                                │
├─────────────────────────────────────────────────────────────┤
│ ┌───────────┐ ┌───────────────────────────────────────────┐ │
│ │ 对话历史   │ │                                           │ │
│ │           │ │                                           │ │
│ │ [+ 新对话] │ │                                           │ │
│ │           │ │              对话消息区                    │ │
│ │ ─今天─    │ │                                           │ │
│ │ 运动记录   │ │                                           │ │
│ │ 支出查询   │ │                                           │ │
│ │           │ │                                           │ │
│ │ ─昨天─    │ │                                           │ │
│ │ 目标设定   │ │                                           │ │
│ │           │ ├───────────────────────────────────────────┤ │
│ │           │ │ [📷] [🎤]  输入消息...            [发送]  │ │
│ └───────────┘ └───────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

左侧边栏宽度: 260px，可收起
```

**结构（移动端）**:

```
┌─────────────────────────────────┐
│  [≡]     AI 对话          [📋] │ ← 左:历史 右:菜单
├─────────────────────────────────┤
│                                 │
│                                 │
│          对话消息区              │
│                                 │
│                                 │
├─────────────────────────────────┤
│ [📷][🎤] 输入消息...     [发送] │
├─────────────────────────────────┤
│  [📊]    [💬]    [+]    [📋]   │
└─────────────────────────────────┘

对话历史: 点击左上角图标打开侧边栏
```

**详细设计**: 参见 Chatbot 模块 2.10 对话界面设计

### 4.5 历史记录页 (/history)

**目的**: 查看、搜索、编辑所有历史记录

**布局**: 完整导航 + 列表/表格

**详细设计**: 参见历史记录模块 4.11 页面设计

### 4.6 404 页面

**布局**: 无导航，全屏

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                        [矩阵雨背景]                          │
│                                                             │
│                          404                                │
│                                                             │
│                   [故障效果文字]                             │
│                 页面不存在或已被删除                          │
│                                                             │
│                      [返回首页]                              │
│                                                             │
└─────────────────────────────────────────────────────────────┘

动画: 404 数字持续故障闪烁
```

## 5. 页面切换动画

### 5.1 故障过渡效果

```css
/* 页面退出 */
.page-exit {
  animation: glitch-out 300ms ease-in forwards;
}

@keyframes glitch-out {
  0% {
    opacity: 1;
    transform: translateX(0);
  }
  20% {
    opacity: 0.8;
    transform: translateX(-5px);
    filter: hue-rotate(90deg);
  }
  40% {
    opacity: 0.6;
    transform: translateX(5px);
    filter: hue-rotate(-90deg);
  }
  60% {
    opacity: 0.4;
    transform: translateX(-3px);
  }
  100% {
    opacity: 0;
    transform: translateX(0);
  }
}

/* 页面进入 */
.page-enter {
  animation: glitch-in 300ms ease-out forwards;
}

@keyframes glitch-in {
  0% {
    opacity: 0;
    transform: translateX(0);
  }
  20% {
    opacity: 0.4;
    transform: translateX(5px);
    filter: hue-rotate(-90deg);
  }
  40% {
    opacity: 0.6;
    transform: translateX(-5px);
    filter: hue-rotate(90deg);
  }
  60% {
    opacity: 0.8;
    transform: translateX(3px);
  }
  100% {
    opacity: 1;
    transform: translateX(0);
    filter: none;
  }
}
```

### 5.2 侧边栏过渡

```css
/* 侧边栏滑入 */
.drawer-enter {
  animation: slide-in-right 300ms ease-out forwards;
}

@keyframes slide-in-right {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

/* 遮罩淡入 */
.overlay-enter {
  animation: fade-in 200ms ease-out forwards;
}
```

### 5.3 减少动画模式

当用户开启「减少动画」设置时：

- 页面切换改为简单淡入淡出（150ms）
- 侧边栏直接显示/隐藏
- 取消所有故障效果

## 6. 响应式断点

| 断点名称 | 宽度范围       | 布局特点                            |
| -------- | -------------- | ----------------------------------- |
| Mobile   | 0 - 639px      | 底部 Tab + 单列 + 全屏侧边栏        |
| Tablet   | 640px - 1023px | 顶部导航 + 2 列 + 侧边栏 480px      |
| Desktop  | 1024px - 1439px| 顶部导航 + 3 列 + 侧边栏 480px      |
| Wide     | 1440px+        | 顶部导航 + 最大宽度 1400px 居中     |

## 7. 模块渲染方式总结

| 模块         | 渲染方式   | 路由              | 说明                         |
| ------------ | ---------- | ----------------- | ---------------------------- |
| 落地页       | 独立页面   | `/`               | 无导航布局                   |
| 登录/注册    | 独立页面   | `/login` `/register` | 无导航布局                |
| Dashboard    | 独立页面   | `/dashboard`      | 完整导航，默认首页           |
| AI 对话      | 独立页面   | `/chat` `/chat/:id` | 完整导航，含对话历史侧边栏 |
| 历史记录     | 独立页面   | `/history`        | 完整导航                     |
| 设置         | 右侧边栏   | 无独立路由        | 从任意页面打开               |
| 行为记录表单 | 右侧边栏   | 无独立路由        | FAB 触发                     |
| 目标表单     | 右侧边栏   | 无独立路由        | FAB 触发                     |
| 随手记表单   | 右侧边栏   | 无独立路由        | FAB 触发                     |
| 记录编辑     | 右侧边栏   | 无独立路由        | 从历史记录打开               |
| 通知中心     | 下拉面板/页面 | 无独立路由     | 桌面端下拉，移动端页面       |

## 8. Z-Index 层级规范

| 层级       | Z-Index | 元素                    |
| ---------- | ------- | ----------------------- |
| 基础内容   | 0       | 页面主体内容            |
| 悬浮按钮   | 100     | FAB                     |
| 顶部导航   | 200     | TopNavbar               |
| 底部导航   | 200     | BottomTabBar            |
| 下拉菜单   | 300     | Dropdown, Popover       |
| 侧边栏遮罩 | 400     | DrawerOverlay           |
| 侧边栏     | 500     | Drawer, SettingsDrawer  |
| 对话框遮罩 | 600     | DialogOverlay           |
| 对话框     | 700     | Dialog, ConfirmDialog   |
| Toast      | 800     | Toast 通知              |
| 全局加载   | 900     | GlobalLoading           |
