# 职责边界定义

> 明确各阶段的职责范围，避免职责越界和冗余

## 核心原则

- **PRD 阶段**: 定义"做什么"和"为什么"（业务层面）
- **UI 设计阶段**: 定义"长什么样"和"如何交互"（视觉和交互层面）
- **技术设计阶段**: 定义"如何实现"（技术实现层面）

## 职责边界矩阵

| 内容类型 | PRD 阶段 | UI 设计阶段 | 技术设计阶段 |
|---------|---------|------------|------------|
| 用户故事 | 应该 | 不应该 | 不应该 |
| 验收标准 | 应该 | 不应该 | 不应该 |
| 功能规格（业务描述） | 应该 | 不应该 | 不应该 |
| 性能指标 | 应该 | 不应该 | 不应该 |
| 业务约束 | 应该 | 不应该 | 不应该 |
| 页面布局 | 不应该 | 应该 | 不应该 |
| 组件外观 | 不应该 | 应该 | 不应该 |
| 交互流程 | 不应该 | 应该 | 不应该 |
| 设计变量 | 不应该 | 应该 | 不应该 |
| API 详细规格 | 不应该 | 不应该 | 应该 |
| 数据库设计 | 不应该 | 不应该 | 应该 |
| TypeScript 类型 | 不应该 | 不应该 | 应该 |
| 组件 Props 定义 | 不应该 | 不应该 | 应该 |
| 算法设计 | 不应该 | 不应该 | 应该 |
| SQL 查询 | 不应该 | 不应该 | 应该 |

## 详细职责定义

### 阶段 02: PRD 编写

**应该包含**:
1. 用户故事：业务需求描述，格式"作为 [角色]，我希望 [操作]，以便 [目标]"，包含优先级
2. 验收标准：业务验证，格式 Given/When/Then，覆盖正常/异常/边界流程
3. 功能规格：业务功能描述（如"支持获取目标列表，可按状态筛选"），不包含 API 请求/响应格式
4. 非功能需求：性能指标（如"加载时间 < 500ms"）、可用性要求，不包含技术实现细节
5. 约束与依赖：业务约束（如"最多 100 个目标"）、数据依赖（如"依赖 behavior_records 表"），不包含技术栈选择
6. 里程碑：阶段产出（如"API 接口"、"Dashboard 组件"），不包含具体文件路径

**不应该包含**:
- API 详细规格（请求/响应格式、TypeScript 类型、错误码）→ 应在 `04-tech-design/api-spec.md`
- 数据库设计（SQL 查询、计算逻辑、表结构）→ 应在 `04-tech-design/tech-design.md`
- 组件 Props 定义（TypeScript 接口）→ 应在 `04-tech-design/tech-design.md`
- 算法详细步骤（技术实现流程）→ 应在 `04-tech-design/tech-design.md`
- 技术栈选择（具体技术选型）→ 应在 `tech-config.md` 或 `04-tech-design`

### 阶段 03: UI 设计

**应该包含**:
1. 页面布局：视觉结构，Desktop/Tablet/Mobile 布局，组件排列、间距、对齐
2. 组件外观：样式、颜色、字体、间距，Loading/Error/Empty 状态，响应式断点
3. 交互流程：用户操作（点击、悬停、输入），状态流转，反馈机制
4. 设计变量：主题变量引用（颜色、字体、间距）
5. 组件功能描述：业务层面描述（如"显示目标列表"、"接收目标列表"），不包含 TypeScript 类型定义

**不应该包含**:
- TypeScript Props 定义（TypeScript 接口、Props 类型）→ 应在 `04-tech-design/tech-design.md`
- API 调用逻辑（数据获取方式、错误处理）→ 应在 `04-tech-design`
- 数据流设计（数据流转、状态管理）→ 应在 `04-tech-design/architecture.md`
- 算法设计（计算逻辑）→ 应在 `04-tech-design/tech-design.md`

### 阶段 04: 技术设计

**应该包含**:
1. 数据模型：表结构、字段类型、索引、SQL 查询、计算逻辑
2. API 详细规格：请求/响应格式、TypeScript 类型、错误码、认证方式
3. TypeScript 类型定义：Client/Server 类型分离、接口定义、类型转换函数
4. 组件架构：Props 的 TypeScript 定义、Hooks 设计、数据流设计
5. 算法设计：详细的计算步骤、处理流程、性能优化方案
6. 任务拆分：05a/05b/05c 具体任务清单、文件路径、代码结构

**不应该包含**:
- 用户故事（业务需求）→ 应在 `02-prd/prd.md`
- 业务规则（业务逻辑）→ 应在 `02-prd/prd.md`
- UI 设计细节（页面布局、组件外观）→ 应在 `03-ui-design/ui-design.md`

## 检查清单

### PRD 阶段检查
- 是否包含 TypeScript 类型定义？→ 移到 04 阶段
- 是否包含 SQL 查询逻辑？→ 移到 04 阶段
- 是否包含 API 请求/响应格式？→ 移到 04 阶段
- 是否包含算法详细步骤？→ 移到 04 阶段
- 是否包含组件 Props 的 TypeScript 定义？→ 移到 04 阶段
- 是否包含技术栈选择（除非是业务约束）？→ 移到 tech-config.md 或 04 阶段

### UI 设计阶段检查
- 是否包含 TypeScript Props 定义？→ 移到 04 阶段
- 是否包含 API 调用逻辑？→ 移到 04 阶段
- 是否包含数据流设计？→ 移到 04 阶段
- 是否包含算法设计？→ 移到 04 阶段

### 技术设计阶段检查
- 是否包含用户故事？→ 移到 02 阶段
- 是否包含业务规则？→ 移到 02 阶段
- 是否包含 UI 设计细节（页面布局、组件外观）？→ 移到 03 阶段

## 常见问题

**Q1: PRD 中能否描述 API 功能？**  
A: 可以，但应该只描述功能（如"获取目标列表"），不应该包含详细的请求/响应格式。详细规格应该在 `04-tech-design/api-spec.md` 中。

**Q2: UI 设计中能否描述组件接收的数据？**  
A: 可以，但应该用业务语言描述（如"接收目标列表"），不应该包含 TypeScript 类型定义。TypeScript 定义应该在 `04-tech-design/tech-design.md` 中。

**Q3: 技术设计中能否描述业务逻辑？**  
A: 可以，但应该只描述技术实现层面的业务逻辑（如"如何计算进度"），不应该包含用户故事和业务规则。用户故事应该在 `02-prd/prd.md` 中。

## 示例对比

### 功能规格描述

**PRD 阶段（正确）**:
```markdown
### 3.1 API 路由（功能描述）

- GET /api/goals: 获取用户所有目标，支持按状态筛选
- POST /api/goals: 创建新目标
```

**技术设计阶段（正确）**:
```markdown
### 2.1 API 接口规格

#### GET /api/goals
**请求**: Headers: Authorization Bearer token
**响应**: { data: Goal[]; error?: string; }
```

### 组件描述

**UI 设计阶段（正确）**:
```markdown
### GoalList 组件

**功能**: 显示目标列表，支持加载状态和空状态
**外观**: 网格布局，每行 3 个卡片（Desktop）
**交互**: 点击目标卡片 → 跳转到详情页
```

**技术设计阶段（正确）**:
```markdown
### 4.3 组件架构

#### GoalList

```typescript
interface GoalListProps {
  goals: Goal[];
  loading?: boolean;
  onGoalClick: (goalId: string) => void;
}
```
```
