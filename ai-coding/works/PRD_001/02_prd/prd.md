# 产品需求文档 (PRD)

> PRD_001 | 可视化模块 | 阶段 02-PRD

## 1. 概述

### 1.1 背景
NEO-LOG Dashboard 当前仅展示基础欢迎信息，用户无法直观查看行为数据和目标进度。本模块实现数据可视化能力，支持快速查看与深度分析双模式。

### 1.2 目标
- 为用户提供一目了然的数据概览
- 支持多维度趋势分析
- 通过可视化激励用户持续记录

### 1.3 成功指标

| 指标 | 目标值 |
|------|--------|
| 首屏加载时间 | < 2s |
| 图表渲染时间 | < 500ms |
| 功能完整度 | 100% Must Have |
| 类型安全 | 0 TS 错误 |

---

## 2. 用户故事

### US-001: 查看今日概览
**优先级**: P0

> 作为一个效率追踪者，我希望在 Dashboard 首屏看到今日统计卡片，以便快速了解当天的行为记录状态。

**验收标准**:
- AC-001-1: Given 用户已登录 When 进入 Dashboard Then 显示今日行为总数卡片
- AC-001-2: Given 用户今日有记录 When 查看卡片 Then 显示各行为类型数量
- AC-001-3: Given 用户今日无记录 When 查看卡片 Then 显示"今日尚无记录"引导

---

### US-002: 查看连续活跃天数
**优先级**: P0

> 作为一个效率追踪者，我希望看到连续活跃天数，以便获得持续记录的激励。

**验收标准**:
- AC-002-1: Given 用户连续多天有记录 When 查看卡片 Then 显示连续天数（如"7天"）
- AC-002-2: Given 用户昨日无记录 When 查看卡片 Then 连续天数重置为1或0
- AC-002-3: Given 连续天数达到里程碑(7/30/100) When 查看卡片 Then 显示特殊视觉效果

---

### US-003: 查看目标达成率
**优先级**: P0

> 作为一个目标驱动者，我希望在概览中看到整体目标达成率，以便快速评估进度。

**验收标准**:
- AC-003-1: Given 用户有进行中的目标 When 查看卡片 Then 显示达成率百分比
- AC-003-2: Given 用户无目标 When 查看卡片 Then 显示"创建目标"引导
- AC-003-3: Given 目标达成率变化 When 对比昨日 Then 显示增减趋势箭头

---

### US-004: 查看行为趋势图
**优先级**: P0

> 作为一个数据分析者，我希望查看行为频次随时间变化的趋势图，以便识别行为规律。

**验收标准**:
- AC-004-1: Given 选择时间范围 When 查看趋势图 Then 显示该范围内的折线图
- AC-004-2: Given 有多种行为类型 When 点击类型筛选 Then 高亮显示选中类型
- AC-004-3: Given 鼠标悬停数据点 When Hover Then 显示具体日期和数值

---

### US-005: 选择时间范围
**优先级**: P0

> 作为一个数据分析者，我希望切换不同时间范围，以便查看不同周期的数据趋势。

**验收标准**:
- AC-005-1: Given 用户在 Dashboard When 点击时间选择器 Then 显示预设选项(今日/7天/30天/90天)
- AC-005-2: Given 选择自定义范围 When 选择日期 Then 刷新所有图表数据
- AC-005-3: Given 切换时间范围 When 数据加载中 Then 显示骨架屏

---

### US-006: 查看活跃度热力图
**优先级**: P0

> 作为一个效率追踪者，我希望看到 GitHub 风格的年度活跃度热力图，以便直观了解全年活跃分布。

**验收标准**:
- AC-006-1: Given 用户有历史数据 When 查看热力图 Then 显示最近12个月的日历视图
- AC-006-2: Given 某天有记录 When 查看该天格子 Then 颜色深度反映记录数量
- AC-006-3: Given 鼠标悬停格子 When Hover Then 显示日期和记录数
- AC-006-4: Given 点击某天格子 When Click Then 显示当天记录列表弹窗

---

### US-007: 查看目标进度环
**优先级**: P0

> 作为一个目标驱动者，我希望以环形进度条查看各目标完成进度，以便追踪具体目标。

**验收标准**:
- AC-007-1: Given 用户有多个目标 When 查看进度区域 Then 显示多个进度环
- AC-007-2: Given 目标有进度 When 查看进度环 Then 显示百分比数值
- AC-007-3: Given 点击某进度环 When Click Then 展开显示关联行为详情
- AC-007-4: Given 目标已完成 When 查看进度环 Then 显示100%完成状态

---

### US-008: 周对比分析
**优先级**: P1

> 作为一个数据分析者，我希望对比本周与上周的数据，以便评估进步或退步。

**验收标准**:
- AC-008-1: Given 有两周以上数据 When 查看对比卡片 Then 显示本周 vs 上周数值
- AC-008-2: Given 本周优于上周 When 查看对比 Then 显示绿色增长箭头
- AC-008-3: Given 本周不如上周 When 查看对比 Then 显示橙色下降箭头

---

### US-009: 分类分布饼图
**优先级**: P1

> 作为一个数据分析者，我希望查看行为类型的分布饼图，以便了解时间精力分配。

**验收标准**:
- AC-009-1: Given 有多种行为类型 When 查看饼图 Then 显示各类型占比
- AC-009-2: Given 鼠标悬停扇区 When Hover Then 显示具体数值和百分比
- AC-009-3: Given 点击扇区 When Click Then 筛选显示该类型行为列表

---

### US-010: 图表数据导出
**优先级**: P2

> 作为一个数据分析者，我希望导出图表数据，以便在其他工具中进一步分析。

**验收标准**:
- AC-010-1: Given 查看任意图表 When 点击导出按钮 Then 显示导出格式选项
- AC-010-2: Given 选择PNG格式 When 确认导出 Then 下载图表图片
- AC-010-3: Given 选择CSV格式 When 确认导出 Then 下载数据文件

---

## 3. 功能规格

### 3.1 概览卡片组

| 卡片 | 数据源 | 计算逻辑 |
|------|--------|----------|
| 今日统计 | behavior_records | COUNT(today) |
| 连续天数 | behavior_records | 连续有记录的天数 |
| 目标达成率 | goals | AVG(progress) |
| 周对比 | behavior_records | this_week / last_week |

### 3.2 图表组件

| 图表 | 类型 | 数据聚合 |
|------|------|----------|
| 行为趋势 | 折线图 | 按日/周/月聚合 |
| 活跃热力图 | 日历热力图 | 按日统计 |
| 目标进度 | 环形进度条 | 实时进度 |
| 分类分布 | 饼图 | 按类型统计 |

### 3.3 交互规格

| 交互 | 行为 |
|------|------|
| Hover | 显示 Tooltip 详情 |
| Click 热力图格子 | 弹窗显示当日列表 |
| Click 进度环 | 展开关联行为 |
| Click 饼图扇区 | 筛选该类型 |

---

## 4. 非功能需求

### 4.1 性能
- 首屏渲染 < 2s (Lighthouse)
- 图表渲染 < 500ms (1000条数据内)
- 支持增量加载（卡片先加载，图表后加载）

### 4.2 响应式
- Mobile: 单列布局，图表支持横向滚动
- Tablet: 双列布局
- Desktop: 多列网格布局

### 4.3 可访问性
- 图表需提供数据表格替代视图
- 颜色对比度符合 WCAG AA

### 4.4 主题
- 深色主题（赛博朋克风格）
- 矩阵绿主色调

---

## 5. 约束与依赖

### 5.1 技术约束
- 使用 Chakra UI 组件
- 图表库需支持 SSR 或动态导入
- TypeScript 严格模式

### 5.2 数据依赖
- `neolog_behavior_records` - 行为记录
- `neolog_goals` - 目标数据
- `neolog_behavior_definitions` - 行为定义

---

## 6. 里程碑

| 阶段 | 产出 |
|------|------|
| 05a | 类型定义、API 契约 |
| 05b | 统计 API 接口 |
| 05c | Dashboard 组件 |
| 06 | 集成测试通过 |

---

## 7. 开放问题

| # | 问题 | 状态 |
|---|------|------|
| 1 | 图表库选型 (Recharts vs Nivo vs ECharts) | 待定 |
| 2 | 热力图是否需要支持年份切换 | 待定 |
| 3 | 是否需要实时刷新 | 不需要 |
